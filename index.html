<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Lemuel Kumarga" />


<title>Estimating Survival Rate of Titanic Passengers</title>

<script src="index_files/jquery-1.12.4/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/navigation-1.1/codefolding.js"></script>
<link href="index_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="index_files/highlightjs-9.12.0/highlight.js"></script>
<script src="index_files/htmlwidgets-0.9/htmlwidgets.js"></script>
<link href="index_files/leaflet-0.7.7/leaflet.css" rel="stylesheet" />
<script src="index_files/leaflet-0.7.7/leaflet.js"></script>
<link href="index_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<link href="index_files/leaflet-label-0.2.2/leaflet.label.css" rel="stylesheet" />
<script src="index_files/leaflet-label-0.2.2/leaflet.label.js"></script>
<script src="index_files/Proj4Leaflet-0.7.2/proj4-compressed.js"></script>
<script src="index_files/Proj4Leaflet-0.7.2/proj4leaflet.js"></script>
<script src="index_files/leaflet-binding-1.1.0/leaflet.js"></script>
<script src="index_files/leaflet-providers-1.0.27/leaflet-providers.js"></script>
<script src="index_files/leaflet-providers-plugin-1.1.0/leaflet-providers-plugin.js"></script>
<link href="index_files/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.css" rel="stylesheet" />
<script src="index_files/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.min.js"></script>
<link href="index_files/fontawesome-4.7.0/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="shared/css/Rmd.css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>






<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Estimating Survival Rate of Titanic Passengers</h1>
<h4 class="author"><em>Lemuel Kumarga</em></h4>

</div>

<div id="TOC">
<ul>
<li><a href="#problem-description">Problem Description</a></li>
<li><a href="#summary-of-results">Summary of Results</a></li>
<li><a href="#preliminaries">Preliminaries</a></li>
<li><a href="#exploration">Exploration</a><ul>
<li><a href="#about-the-data">About the Data</a></li>
<li><a href="#preliminary-insights">Preliminary Insights</a><ul>
<li><a href="#on-incomepassenger-class">On Income[/Passenger Class]</a></li>
<li><a href="#on-title">On Title</a></li>
<li><a href="#on-age">On Age</a></li>
<li><a href="#on-company">On Company</a></li>
<li><a href="#on-cabin-positions">On Cabin Positions</a></li>
<li><a href="#on-embakartion-ports">On Embakartion Ports</a></li>
</ul></li>
</ul></li>
<li><a href="#preparation">Preparation</a></li>
<li><a href="#the-random-forest-model">The <i>Random Forest</i> Model</a></li>
<li><a href="#predictive-results">Predictive Results</a></li>
</ul>
</div>

<section id="problem-description" class="level2">
<h2>Problem Description</h2>
<p>Set for its maiden voyage in 1912, RMS Titanic was then considered unsinkable due to its robust structure. After picking up passengers in Southampton, Cherbourg and Queenstown, the ship set sail towards New York. It was on their way there that the Titanic met its calamitous fate, crashing into an Iceberg and rendering more than 50% of the passengers lost.</p>
<p>There were many questions concerning the events leading to and during the disaster. Some of these include: Which part of the ship was most damaged? What was the evacuation process of the passengers? Using data containing the personal details and disaster outcomes (survival/lost) of passengers, we will aim to answer the following set of questions.</p>
<p><span class="color-1-text">FYI: This problem was posed as an introductory challenge in <a href="https://www.kaggle.com/c/titanic" target="_blank">Kaggle</a>. The passengers are divided into two sets, one used for training and the other for testing. The training sets contain both the personal details of passengers and their outcomes, while the testing set only contain the former. By developing a robust model through the training set, we hope to predict the survival likelihood of passengers in the testing set.</span></p>
</section>
<section id="summary-of-results" class="level2">
<h2>Summary of Results</h2>
<p>To be completed.</p>
</section>
<section id="preliminaries" class="level2">
<h2>Preliminaries</h2>
<p>First load the necessary packages for this exercise.</p>
<pre class="r"><code># Load default settings for R Markdown -- see file for more details
source(&quot;shared/defaults.R&quot;)

options(stringsAsFactors = FALSE)
packages &lt;- c(&quot;dplyr&quot;,&quot;ggplot2&quot;,&quot;randomForest&quot;,&quot;tidyr&quot;,&quot;leaflet&quot;,&quot;purrr&quot;,&quot;grDevices&quot;,&quot;pander&quot;)
load_or_install.packages(packages)

data_dir &lt;- &quot;data/&quot;

# Load some helper functions
source(&quot;shared/helper.R&quot;)

si &lt;- sessionInfo()
base_pkg_str &lt;- paste0(&quot;Base Packages: &quot;,paste(si[[&quot;basePkgs&quot;]], collapse=&quot;, &quot;))
attached_pkg_str &lt;- paste0(&quot;Attached Packages: &quot;,paste(names(si[[&quot;otherPkgs&quot;]]), collapse=&quot;, &quot;))
cat(paste0(base_pkg_str,&quot;\n&quot;,attached_pkg_str))</code></pre>
<pre><code>## Base Packages: stats, graphics, grDevices, utils, datasets, methods, base
## Attached Packages: purrr, leaflet, tidyr, randomForest, pander, ggplot2, dplyr, knitr</code></pre>
</section>
<section id="exploration" class="level2">
<h2>Exploration</h2>
<section id="about-the-data" class="level3">
<h3>About the Data</h3>
<p>We kick off by exploring the data that was provided:</p>
<pre class="r"><code># Provides high level information about a particular data frame
# @input data: the data frame
# @input null_fn: a function that takes in a value (like those in the cells)
# and outputs true if value corresponds to the equivalent null value, false
# otherwise. For example, we may want to consider 0 as nulls on some scenarios
# but not on others.
# @output A data frame showing
# - Name of the Columns
# - Type of Variables in Each Column
# - Some Non-Null Examples of Each Column
# - % of Values that are Non-Null in Each Column (% Filled)
data_overview &lt;- function(data,
                          null_fn = function(cname) { paste0(cname,&quot; == &#39;&#39; | is.na(&quot;,cname,&quot;)&quot;)}) {
                  
                  cols_summary &lt;- data.frame(ColumnNames = colnames(data))
                  cols_summary$Type &lt;- lapply(training_set, class) %&gt;%
                    toupper()
                  cols_summary$Examples &lt;- lapply(cols_summary$ColumnNames,
                                                  function(cname) {
                                                    training_set %&gt;%
                                                      filter_(paste0(&quot;!(&quot;,null_fn(cname),&quot;)&quot;)) %&gt;%
                                                      `[[`(cname) %&gt;%
                                                      unique() -&gt; filtered_set
                                                    filtered_set[1:min(5, length(filtered_set))] %&gt;%
                                                      paste(collapse=&#39; | &#39;)
                                                  })
                  cols_summary$EmptyValues &lt;- lapply(cols_summary$ColumnNames,
                                                     function(cname) {
                                                       training_set %&gt;%
                                                         filter_(null_fn(cname)) %&gt;%
                                                         nrow()
                                                     })
                  cols_summary$PctFilled &lt;- lapply(cols_summary$EmptyValues,
                                                   function(x) {
                                                     ((nrow(training_set) - x) / nrow(training_set)) %&gt;%
                                                       `*`(100) %&gt;% round(0) %&gt;%
                                                       paste0(&quot;%&quot;)
                                                   })
                  
                  select(cols_summary, ColumnNames, Type, Examples, PctFilled)
}
  
training_set &lt;- read.csv(paste0(data_dir, &quot;train.csv&quot;))

cols_summary &lt;- data_overview(training_set)

pander(cols_summary, caption=&quot;Titanic Passengers Data&quot;)</code></pre>
<table style="width:96%;">
<caption>Titanic Passengers Data <br></caption>
<colgroup>
<col style="width: 19%" />
<col style="width: 16%" />
<col style="width: 44%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ColumnNames</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Examples</th>
<th style="text-align: left;">PctFilled</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PassengerId</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">1 | 2 | 3 | 4 | 5</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Survived</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">0 | 1</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pclass</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">3 | 1 | 2</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">Braund, Mr. Owen Harris | Cumings, Mrs. John Bradley (Florence Briggs Thayer) | Heikkinen, Miss. Laina | Futrelle, Mrs. Jacques Heath (Lily May Peel) | Allen, Mr. William Henry</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sex</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">male | female</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age</td>
<td style="text-align: left;">NUMERIC</td>
<td style="text-align: left;">22 | 38 | 26 | 35 | 54</td>
<td style="text-align: left;">80%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SibSp</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">1 | 0 | 3 | 4 | 2</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parch</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">0 | 1 | 2 | 5 | 3</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ticket</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">A/5 21171 | PC 17599 | STON/O2. 3101282 | 113803 | 373450</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fare</td>
<td style="text-align: left;">NUMERIC</td>
<td style="text-align: left;">7.25 | 71.2833 | 7.925 | 53.1 | 8.05</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cabin</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">C85 | C123 | E46 | G6 | C103</td>
<td style="text-align: left;">23%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Embarked</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">S | C | Q</td>
<td style="text-align: left;">100%</td>
</tr>
</tbody>
</table>
<p>Based on the summary above, notice the following:</p>
<ul>
<li><span class="hl color-1-text">Names</span> are aggregated in the following format: <span class="hl color-2-text">Last_Name, Title First_Name</span>.</li>
<li><span class="hl color-1-text">Passenger class (Pclass) </span> levels are the equivalent of <span class="hl color-2-text">First Class (1), Business Class (2) and Economy Class (3)</span>. Hence, they could be used as an indicator of income level.</li>
<li>There are different types of <span class="hl color-1-text">Ticket</span> formats.</li>
<li><span class="hl color-1-text">Age</span> has missing data to be populated.</li>
<li><span class="hl color-1-text">Cabin</span> data is sparse, and hence we may want to exclude this for the prediction model.</li>
</ul>
</section>
<section id="preliminary-insights" class="level3">
<h3>Preliminary Insights</h3>
<section id="on-incomepassenger-class" class="level4">
<h4>On Income[/Passenger Class]</h4>
<div class="st">
Hypothesis 1: Higher income individuals are more likely to survive.
</div>
<p>High-income individuals could pay more for seats in the lifeboats, and hence escape the disaster.</p>
<pre class="r"><code>income_set &lt;- training_set %&gt;%
              group_by(Pclass) %&gt;%
              summarise(CohortSize = n(),
                        SurvivalRate = sum(Survived)/n())

income_plot &lt;-  ggplot(income_set, aes(x=SurvivalRate,
                                      y = 0,
                                      color=as.factor(Pclass),
                                      size=CohortSize)) +
                theme_lk() +
                theme(plot.margin = unit(c(0,0,0,-40),&#39;pt&#39;)) +
                # Legends
                theme(
                  legend.position = c(0.5,0.2),
                  legend.box.just = c(0.5,0.5),
                  legend.justification = c(0.5,0.5)
                ) +
                scale_color_manual(name = &quot;Passenger Class&quot;,
                                  labels = c(&quot;1&quot;=&quot;1 (High-Income)&quot;,&quot;2&quot;=&quot;2 (Medium-Income)&quot;,&quot;3&quot;=&quot;3 (Low-Income)&quot;),
                                  values = c(&quot;1&quot;=as.character(get_color(&quot;green&quot;)),
                                             &quot;2&quot;=as.character(get_color(&quot;yellow&quot;)),
                                             &quot;3&quot;=as.character(get_color(&quot;red&quot;))),
                                  guide = guide_legend(order = 1,
                                                       direction = &quot;vertical&quot;,
                                                       override.aes=list(size=5))) +
               scale_size_continuous(name = &quot;Cohort Size&quot;,
                                     range = c(5,20),
                                     guide = guide_legend(order = 2)) +
               # X Axis
                theme(
                  axis.line.x = element_line(colour=NA),
                  axis.ticks.x = element_line(colour=NA),
                  axis.title.x = element_text(colour=NA),
                  axis.text.x = element_text(colour=NA)
                ) +
               geom_segment(aes(x=0.2, xend=0.7, y=0, yend=0),
                            size = 0.5,
                            color=ltxt_color,
                            arrow = arrow(length = unit(10,&quot;pt&quot;),
                                          type = &quot;closed&quot;)) +
               geom_text(label = &quot;Survival Likelihood&quot;,
                         x = 0.7,
                         y = 0.02,
                         family = def_font,
                         color = ltxt_color,
                         size = 5,
                         hjust = 1) +
               # Y Axis
                theme(
                  axis.line.y = element_line(colour=NA),
                  axis.ticks.y = element_line(colour=NA),
                  axis.title.y = element_text(colour=NA),
                  axis.text.y = element_text(colour=NA)
                ) +
               scale_y_continuous(limits=c(-0.12, 0.05)) +
               # Elements
                geom_point(alpha=0.5) +
                geom_text(aes(y = -0.03, label=paste0(round(SurvivalRate*100,0),&quot;%&quot;)),
                          size=4,
                          color=txt_color,
                          family=def_font)

income_plot</code></pre>
<p><img src="index_files/figure-html/exp_hypo1-1.png" width="960" style="display: block; margin: auto;" /> Using the passenger class as a proxy for income, we find this claim to be <span class="hl green-text">TRUE</span>.</p>
<pre class="r"><code>appendFarePUnit &lt;- function(dt) { dt %&gt;%  mutate(Fare_P_Unit = Fare / (1 + SibSp + Parch)) }

fares_set &lt;- appendFarePUnit(training_set) %&gt;%
             select(Fare_P_Unit, Pclass, Survived)

rows_p_fare_bin &lt;- 80
fares_pdata &lt;- fares_set %&gt;%
               arrange(Fare_P_Unit) %&gt;%
               mutate(Group = as.integer((row_number() - 1) / rows_p_fare_bin)+1) %&gt;%
               group_by(Group) %&gt;%
               summarise(FareMax = min(Fare_P_Unit),
                         Survived = sum(Survived),
                         CohortSize = n()) %&gt;%
               mutate(SurvivalRate = Survived / CohortSize)
fares_pdata &lt;- rbind(fares_pdata, c(0,0,0,0,0), c(max(fares_pdata$Group)+1,max(fares_set$Fare_P_Unit),0,0,0)) %&gt;%
               arrange(Group)

fares_plot &lt;- ggplot(fares_pdata, aes(x = FareMax,
                                      y = SurvivalRate)) +
              theme_lk() +
              xlab(&quot;Fares / Head&quot;) +
              scale_x_continuous(labels = scales::dollar) +
              ylab(&quot;Survival Likelihood&quot;) +
              scale_y_continuous(labels = scales::percent) +
              geom_step(color = get_color(1))

fares_plot</code></pre>
<p><img src="index_files/figure-html/exp_hypo1_p2-1.png" width="960" style="display: block; margin: auto;" /> We also noticed this phenomenon in fares, where the higher amount an individual paid for the fares, the more likely he/she will survive the crash.</p>
</section>
<section id="on-title" class="level4">
<h4>On Title</h4>
<div class="st">
Hypothesis 2: Gender information is embedded under the title of the individual.
</div>
<p>Most titles are provided based on the gender on the individual, hence we should expect the hypothesis to hold true.</p>
<pre class="r"><code>prefix &lt;- function(x) { unlist(strsplit(unlist(strsplit(x, &quot;, &quot;))[2],&quot;\\. &quot;))[1] }

gender_set &lt;- training_set %&gt;%
              mutate(Prefix = as.character(lapply(Name, prefix))) %&gt;%
              select(Prefix, Sex)
prefix_totals &lt;- gender_set %&gt;%
                 group_by(Prefix) %&gt;%
                 summarise(total = n())
gender_sex_totals &lt;- gender_set %&gt;%
                     group_by(Prefix, Sex) %&gt;%
                     summarise(val=n()) %&gt;%
                     left_join(prefix_totals, by=c(&quot;Prefix&quot;)) %&gt;%
                     mutate(
                       pct = ifelse(Sex == &quot;female&quot;,1.,-1.) * val / total
                     ) %&gt;%
                     arrange(desc(val))
gender_sex_totals$Prefix &lt;- factor(gender_sex_totals$Prefix, levels=unique(gender_sex_totals$Prefix))

gender_plot &lt;- ggplot(gender_sex_totals, aes(x = Prefix,
                                             y = Sex,
                                             fill = Sex,
                                             alpha = val)) +
               theme_lk() +
               scale_fill_manual(values=c(&quot;female&quot;=as.character(get_color(&quot;red&quot;)),
                                           &quot;male&quot;=as.character(get_color(&quot;blue&quot;))),
                                    guide = &quot;none&quot;) +
               scale_alpha_continuous(limits = c(0,25),
                                       range = c(0.3,1),
                                       name = &quot;Cohort Size&quot;,
                                       guide = guide_legend(
                                         nrow = 1,
                                         override.aes=list(fill=ltxt_color)
                                       )) +
                xlab(&quot;Title&quot;) +
                scale_x_discrete(expand = c(0, 0)) +
                scale_y_discrete(expand = c(0, 0),
                                 labels = c(&quot;female&quot;=&quot;F&quot;,&quot;male&quot;=&quot;M&quot;)) +
                ylab(&quot;Gender&quot;) +
                geom_tile(colour = bg_color, size = 5)

gender_plot</code></pre>
<p><img src="index_files/figure-html/exp_hypo2-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>As can be seen, almost every title has a mapping to the gender of the individual, suggesting that every title is associated with a gender. The only notable exception is “Dr”, which is gender neutral. Hence, the hypothesis is <span class="hl green-text">TRUE</span>.</p>
<div class="st">
Hypothesis 3: Females and more esteemed individuals are more likely to survive than males.
</div>
<p>Prior to this analysis, we will group those individuals without “Mr”,“Mrs”,“Miss”, or “Master” title as “Rare title” individuals. These individuals, along with females, would have higher priority in onboarding the lifeboats, hence we assume that they are more likely to survive the crash.</p>
<pre class="r"><code>appendTitle &lt;- function(data) {
  data %&gt;%
  mutate(Title = as.character(lapply(Name, prefix))) %&gt;%
  mutate(Title = ifelse(Title %in% c(&quot;Mr&quot;,&quot;Mrs&quot;,&quot;Miss&quot;,&quot;Master&quot;), Title,
                        ifelse(Sex == &quot;male&quot;,&quot;Rare Title / M&quot;, &quot;Rare Title / F&quot;)))
}

title_set &lt;- appendTitle(training_set) %&gt;%
             select(Title, Sex, Survived) %&gt;%
             group_by(Title, Sex) %&gt;%
             summarise(survive = sum(Survived) / n()) %&gt;%
             arrange(desc(survive))

title_set$Title &lt;- factor(title_set$Title, levels=c(title_set$Title))

title_plot &lt;- ggplot(title_set, aes(x=Title,
                                    y=survive,
                                    fill=Sex)) +
              theme_lk() +
              scale_fill_manual(name = &quot;Gender&quot;,
                                  label = c(&quot;male&quot;=&quot;Male&quot;, &quot;female&quot;=&quot;Female&quot;),
                                  values = c(&quot;male&quot;= as.character(get_color(&quot;blue&quot;)),
                                             &quot;female&quot; = as.character(get_color(&quot;red&quot;))),
                                   guide = guide_legend()) +

              xlab(&quot;Title&quot;) +
              ylab(&quot;Survival Likelihood&quot;) +
              scale_y_continuous(labels = scales::percent,
                                 # Make Sure Bar and X-Axis Stick Together
                                 expand = c(0,0)) +
              geom_bar(stat=&quot;identity&quot;,
                       width = .5) +
              geom_text(aes(y = survive - 0.08,
                            label=paste0(round(survive*100),&quot;%&quot;)),
                        color = &quot;#FFFFFF&quot;,
                        family=def_font,
                        size=4)

title_plot</code></pre>
<p><img src="index_files/figure-html/exp_hypo3-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>As expected, females are more likely to survive than males, while “esteemed” titles increase the survival likelihood of both genders. Hence, the hypothesis is <span class="hl green-text">TRUE</span>.</p>
</section>
<section id="on-age" class="level4">
<h4>On Age</h4>
<div class="st">
Hypothesis 4: Individuals who are very young and very old are more likely to survive.
</div>
<pre class="r"><code>age_set &lt;- training_set %&gt;%
           select(Age, Survived) %&gt;%
           filter(Age &gt; 0)

rows_p_age_bin &lt;- 50
age_pdata &lt;- age_set %&gt;%
                 arrange(Age) %&gt;%
                 mutate(Group = as.integer((row_number() - 1)/rows_p_age_bin) + 1) %&gt;%
                 group_by(Group) %&gt;%
                 summarise(AgeMin = min(Age),
                           Survived = sum(Survived),
                           CohortSize = n(),
                           SurviveL = Survived/CohortSize)
age_pdata &lt;- rbind(age_pdata,
                   c(0,0,0,0,0),
                   c(max(age_pdata$Group)+1,max(age_set$Age),0,0,0)) %&gt;%
             arrange(Group)

age_plot &lt;- ggplot(age_pdata, aes(x=AgeMin,
                                      y=SurviveL)) +
            theme_lk() +
            xlab(&quot;Age&quot;) +
            scale_x_continuous(breaks=seq(0,max(age_pdata$AgeMin),by=10)) +
            ylab(&quot;Survival Likelihood&quot;) +
            scale_y_continuous(labels = scales::percent,
                               expand = c(0.4, -0.15)) +
                  # Actual Data
                  geom_step(color=get_color(1)) +
                  geom_vline(data = age_pdata %&gt;%
                                    filter(row_number() %in% c(3,16)),
                             aes(xintercept = AgeMin),
                             linetype = &quot;dashed&quot;,
                             color = ltxt_color) +
                  geom_text(data = age_pdata %&gt;%
                                   filter(row_number() %in% c(3,16)),
                            aes(x = AgeMin + 6, label = paste(AgeMin, &quot;Years Old&quot;)),
                            y = max(age_pdata$SurviveL),
                            color = ltxt_color,
                            size = 5,
                            family = def_font)

age_plot</code></pre>
<p><img src="index_files/figure-html/exp_hypo4-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>With the limited data set, we can see that younger individuals are more likely to survive. A possible explanation is probably because babies and toddlers occupy less space (and hence easier to find seats within the lifeboats).</p>
<p>However, older people, especially those more than 60 years old, are less likely to survive. This is probably due to their lack of agility in responding to the crash.</p>
<p>Hence, the premise is <span class="hl green-text">TRUE</span> for young children and <span class="hl red-text">FALSE</span> for older people.</p>
</section>
<section id="on-company" class="level4">
<h4>On Company</h4>
<div class="st">
Hypothesis 5: Individuals with children are more likely to survive, while individuals with same-age company are less likely to survive.
</div>
<pre class="r"><code>company_set &lt;- training_set %&gt;%
                select(SibSp, Parch, Survived) %&gt;%
                group_by(SibSp, Parch) %&gt;%
                summarise(CohortSize = n(),
                          SurvivalRate = sum(Survived)/n())

company_plot &lt;- ggplot(company_set, aes(x = as.factor(Parch),
                                        y = as.factor(SibSp),
                                        fill = SurvivalRate,
                                        alpha = CohortSize)) +
                theme_lk() + 
                  ########### LEGENDS ###########
                  scale_fill_gradientn(name = &quot;Survival Likelihood&quot;,
                                       colours=c(as.character(get_color(&quot;red&quot;)),
                                                 as.character(get_color(&quot;red&quot;)),
                                                 as.character(get_color(&quot;yellow&quot;)),
                                                 as.character(get_color(&quot;green&quot;)),
                                                 as.character(get_color(&quot;green&quot;))),
                                       values = c(0.0,0.4,0.5,0.6,1.0),
                                       guide = &quot;none&quot;) +
                  scale_alpha_continuous(limits = c(0,25),
                                         name = &quot;Cohort Size&quot;,
                                         guide = guide_legend(
                                           nrow = 1,
                                           override.aes=list(fill=ltxt_color)
                                         )) +
                  ########### X-AXIS ###########
                  xlab(&quot;# of Different-Age Company (e.g. Children / Parents)&quot;) +
                  scale_x_discrete(expand = c(0, 0)) +
                  ########### Y-AXIS ###########
                  ylab(&quot;# of Same-Age Company (e.g. Spouse / Siblings)&quot;) +
                  ########### ELEMENTS ###########
                geom_tile(colour = bg_color, size = 7) +
                geom_text(aes(label = paste0(round(SurvivalRate*100),&quot;%&quot;)),
                          color = &quot;white&quot;,
                          alpha = 1,
                          size = 5,
                          family = def_font)

company_plot</code></pre>
<p><img src="index_files/figure-html/exp_hypo5-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>As can be seen from the chart above, individuals with 1 to 2 children are more likely to survive than those without any children. It is inconclusive to determine from the chart above, whether same-age company has an impact of survivalhood. Hence, this premise is <span class="hl yellow-text">TRUE TO A LIMITED EXTENT</span>.</p>
<!---

<div class="st">Hypothesis 6: Groups are able to be identified based on their ticket IDs. </div>

If this is true, we should expect to see some correlation between: 

1. the number of companies with the individual, and
2. the number of other individuals with the same ticket.


```r
cleanTickets <- function(x) { toupper(gsub("[[:punct:]]|[[:space:]]","",x)) }

com_ticket_set <- training_set %>%
                  mutate(TicketParsed = sapply(Ticket, cleanTickets))

ticket_sum_set <- com_ticket_set %>%
                  group_by(TicketParsed) %>%
                  summarise(Size = n())

com_ticket_set <- com_ticket_set %>%
                  left_join(ticket_sum_set, by=c("TicketParsed")) %>%
                  mutate( OtherCompany = SibSp + Parch,
                          OtherTickets = Size - 1) %>%
                  group_by(OtherCompany, OtherTickets) %>%
                  summarise(CohortSize = n())
com_ticket_cor <- cor(com_ticket_set$OtherCompany, com_ticket_set$OtherTickets)

com_ticket_plot <- ggplot(com_ticket_set, aes(x = OtherCompany,
                                              y = OtherTickets,
                                              alpha = CohortSize)) +
                  theme_lk() + 
                  ########### LEGENDS ###########
                  scale_alpha_continuous(name = "Cohort Size",
                                         limits = c(0,50),
                                         guide = guide_legend(
                                           nrow = 1,
                                           override.aes=list(fill=ltxt_color)
                                         )) +
                  ########### X-AXIS ###########
                  xlab("# Company") +
                  scale_x_continuous(labels = scales::comma) +
                  ########### Y-AXIS ###########
                  ylab("# Other Individuals with Same Ticket") +
                  ########### ELEMENTS ###########
                  geom_tile(fill = get_color(1)) +
                  geom_text(label = paste0("'Correlation'~rho~': ",round(com_ticket_cor*100),"%'"),
                            data = data.frame(1),
                            x = 10,y = 6, hjust = 1,
                            family = def_font, size = 5,
                            alpha = 1, color = txt_color,
                            parse=TRUE)

com_ticket_plot
```

<img src="index_files/figure-html/exp_hypo6-1.png" width="672" style="display: block; margin: auto;" />

A correlation of <b>36%</b> suggests that there is in fact some correlation between ticket IDs and the identity of the group. Hence, this hypothesis is <span class="hl green-text">TRUE</span>.

-->
</section>
<section id="on-cabin-positions" class="level4">
<h4>On Cabin Positions</h4>
<div class="st">
Hypothesis 6: Cabin positions should have an impact of survivalhood, but only to a certain extent.
</div>
<p>Cabins further away from the lifeboats will have a more difficult time surviving, hence we should assume that where passengers stay will have an impact on their survivalhood. However, the cabin positions can only determine survivalhood partially, given that passengers may not be at their cabins during the time of crash.</p>
<p>A more detailed deck plan can be found <a href="https://www.encyclopedia-titanica.org/titanic-deckplans/b-deck.html" target="_blank">here</a>. As can be seen, the letter of the cabin represents the deck (floor) where the room is located. We also see that odd numbers correspond to one side of the Titanic, while even numbers correspond to the other.</p>
<p>We will break down the cabin position into three constituents: the cabin floor, the cabin number (odd or even), and the number of cabins specified.</p>
<pre class="r"><code>getCabinFloor &lt;- function(x) {

  if (x == &quot;&quot;) { return(&quot;NA&quot;) }

  ltr &lt;- unique(strsplit(gsub(&quot;[0-9]&quot;,&quot;&quot;,x),&quot; &quot;)[[1]])
  if (length(ltr) == 1) {
    ltr
  } else {
    &quot;Multiple&quot;
  }

}

getCabinNumber &lt;- function(x) {

  if (x == &quot;&quot;) { return(&quot;NA&quot;) }

  num &lt;- as.integer(strsplit(gsub(&quot;[A-z]&quot;,&quot;&quot;,x),&quot; &quot;)[[1]]) %% 2

  if (is.nan(mean(num))) {
    return(&quot;NA&quot;)
  } else if (length(unique(num)) == 1) {
    if (unique(num) == 0) { return(&quot;Even&quot;) } else { return(&quot;Odd&quot;) }
  } else {
    return(&quot;Mixed&quot;)
  }

}

getCabinCount &lt;- function(x) {
  if (x == &quot;&quot;) { return(&quot;NA&quot;) }
  length(strsplit(x,&quot; &quot;)[[1]])
}

appendCabinInfo &lt;- function(data) {
  data %&gt;%
  mutate(
    CabinFloor = sapply(Cabin, getCabinFloor),
    CabinNumber = sapply(Cabin, getCabinNumber),
    CabinCount = sapply(Cabin, getCabinCount)
  )
}

cabin_set &lt;- appendCabinInfo(training_set) %&gt;%
             select(CabinFloor,CabinNumber,CabinCount, Survived)</code></pre>
<section id="cabin-floors" class="level5">
<h5>Cabin Floors</h5>
<pre class="r"><code>cabinLet_set &lt;- cabin_set %&gt;%
                group_by(CabinFloor) %&gt;%
                summarise(CohortSize = n(),
                          SurvivalRate = sum(Survived)/n())

cabinLet_plot &lt;- ggplot(cabinLet_set, aes(x=as.factor(CabinFloor),
                                          y=SurvivalRate,
                                          alpha = CohortSize,
                                          fill = SurvivalRate)) +
                  theme_lk() + 
                    ########### LEGENDS ###########
                  scale_alpha_continuous(name = &quot;Cohort Size&quot;,
                                         limits = c(0,30),
                                         guide = guide_legend(
                                           nrow = 1,
                                           override.aes=list(fill=ltxt_color)
                                         )) +
                  scale_fill_gradientn(colours=c(as.character(get_color(&quot;red&quot;)),
                                                 as.character(get_color(&quot;red&quot;)),
                                                 as.character(get_color(&quot;yellow&quot;)),
                                                 as.character(get_color(&quot;green&quot;)),
                                                 as.character(get_color(&quot;green&quot;))),
                                       values = c(0.0,0.4,0.5,0.6,1.0),
                                       guide = &quot;none&quot;) +
                    ########### X-AXIS ###########
                    xlab(&quot;Cabin Floor&quot;) +
                    ########### Y-AXIS ###########
                    ylab(&quot;Survival Likelihood&quot;) +
                    scale_y_continuous(labels = scales::percent,
                                       # Make Sure Bar and X-Axis Stick Together
                                       expand = c(0,0),
                                       limits =c(0,1)) +
                    ########### ELEMENTS ###########
                  # Actual Data
                  geom_bar(stat=&quot;identity&quot;) +
                    geom_text(aes(y = SurvivalRate - 0.08,
                                  label=paste0(round(SurvivalRate*100),&quot;%&quot;)),
                              color = &quot;#FFFFFF&quot;, alpha = 1,
                              family=def_font,size=4)

cabinLet_plot</code></pre>
<p><img src="index_files/figure-html/exp_hypo7_p1-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>From the chart, we can deduce that <span class="hl yellow-text">Cabins B to E</span> has a higher likelihood of survival compared to other/unspecified cabins, which suggests that the position of cabins play a role in determining whether a passenger survive.</p>
</section>
<section id="cabin-numbers" class="level5">
<h5>Cabin Numbers</h5>
<pre class="r"><code>cabinNumber_set &lt;- cabin_set %&gt;%
                   group_by(CabinNumber) %&gt;%
                    summarise(CohortSize = n(),
                              SurvivalRate = sum(Survived)/n())
cabinNumber_set$CabinNumber &lt;- factor(cabinNumber_set$CabinNumber, levels=c(&quot;Even&quot;,&quot;Odd&quot;,&quot;Mixed&quot;,&quot;NA&quot;))

cabinNumber_plot &lt;- ggplot(cabinNumber_set, aes(x = SurvivalRate,
                                                y = 0,
                                                color=CabinNumber,
                                                size=CohortSize)) +
                    theme_lk() +
                    ########### LEGENDS ###########
                      theme(plot.margin = unit(c(0,0,0,-40),&#39;pt&#39;)) +
                        # Legends
                        theme(
                          legend.position = c(0.5,0.2),
                          legend.box.just = c(0.5,0.5),
                          legend.justification = c(0.5,0.5)
                        ) +
                      scale_color_manual(name = &quot;Room Type&quot;,
                                         values = get_color(),
                                         guide = guide_legend(order = 1,
                                                              direction = &quot;vertical&quot;,
                                                              override.aes=list(size=5),
                                                              ncol= 2)) +
                      scale_size_continuous(name = &quot;Cohort Size&quot;,
                                            range = c(5,20),
                                            guide = guide_legend(order = 2)) +
                      ########### X-AXIS ###########
                    theme(
                      axis.line.x = element_line(colour=NA),
                      axis.ticks.x = element_line(colour=NA),
                      axis.title.x = element_text(colour=NA),
                      axis.text.x = element_text(colour=NA)
                    ) +
                      # Add X Axis Line
                      geom_segment(aes(x=0.25, xend=0.8, y=0, yend=0),
                                   size = 0.5,
                                   color=ltxt_color,
                                   arrow = arrow(length = unit(10,&quot;pt&quot;),
                                                 type = &quot;closed&quot;)) +
                      geom_text(label = &quot;Survival Likelihood&quot;,
                                x = 0.8,
                                y = 0.02,
                                family = def_font,
                                color = ltxt_color,
                                size = 5,
                                hjust = 1) +
                      ########### Y-AXIS ###########
                    theme(
                      # Y-Axis
                      axis.line.y = element_line(colour=NA),
                      axis.ticks.y = element_line(colour=NA),
                      axis.title.y = element_text(colour=NA),
                      axis.text.y = element_text(colour=NA)) +
                      scale_y_continuous(limits=c(-0.12, 0.05)) +
                      ########### ELEMENTS ###########
                    geom_point(alpha=0.5) +
                      geom_text(aes(y = -0.03, label=paste0(round(SurvivalRate*100,0),&quot;%&quot;)),
                                size=4,
                                color=txt_color,
                                family=def_font)


cabinNumber_plot</code></pre>
<p><img src="index_files/figure-html/exp_hypo7_p2-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>It is pretty clear that those who stay in the odd rooms are more likely to survive than those in the even rooms.</p>
</section>
<section id="cabins-specified" class="level5">
<h5>Cabins Specified</h5>
<pre class="r"><code>cabinCount_set &lt;- cabin_set %&gt;%
                  group_by(CabinCount) %&gt;%
                  summarise(CohortSize = n(),
                            SurvivalRate = sum(Survived)/n())

cabinCount_plot &lt;- ggplot(cabinCount_set, aes(x=as.factor(CabinCount),
                                              y=SurvivalRate,
                                              alpha = CohortSize,
                                              fill = SurvivalRate)) +
                   theme_lk() +
                    ########### LEGENDS ###########
                    scale_alpha_continuous(name = &quot;Cohort Size&quot;,
                                           limits = c(0,50),
                                           guide = guide_legend(
                                             nrow = 1,
                                             override.aes=list(fill=ltxt_color)
                                           )) +
                    scale_fill_gradientn(colours=c(as.character(get_color(&quot;red&quot;)),
                                                   as.character(get_color(&quot;red&quot;)),
                                                   as.character(get_color(&quot;yellow&quot;)),
                                                   as.character(get_color(&quot;green&quot;)),
                                                   as.character(get_color(&quot;green&quot;))),
                                         values = c(0.0,0.3,0.4,0.50,1.),
                                         guide = &quot;none&quot;) +
                    ########### X-AXIS ###########
                    xlab(&quot;# Cabins Specified&quot;) +
                    ########### Y-AXIS ###########
                    ylab(&quot;Survival Likelihood&quot;) +
                    scale_y_continuous(labels = scales::percent,
                                       # Make Sure Bar and X-Axis Stick Together
                                       expand = c(0,0),
                                       limits =c(0,1)) +
                    ########### ELEMENTS ###########
                  # Actual Data
                  geom_bar(stat=&quot;identity&quot;,
                           width = 0.7) +
                  geom_text(aes(y = SurvivalRate - 0.1,
                                label=paste0(&quot;Cohort\nSize:\n&quot;,CohortSize)),
                            color = &quot;#FFFFFF&quot;, alpha = 1,
                            family=def_font,size=4)

cabinCount_plot</code></pre>
<p><img src="index_files/figure-html/exp_hypo7_p3-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Even though seems to be an inverse relationship between the survival likelihood and number of cabins specified, the sample size is too small to ensure statistical significance.</p>
<p>In conclusion, cabin floors and cabin numbers can determine a passenger’s survival likelihood, while there is too little data to deduce a relationship in the number of cabins specified. Hence, the hypothesis is <span class="hl green-text">TRUE</span>.</p>
</section>
</section>
<section id="on-embakartion-ports" class="level4">
<h4>On Embakartion Ports</h4>
<div class="st">
Hypothesis 7: Port of embarkation should have no impact on survivalhood.
</div>
<pre class="r"><code>embark_set &lt;- training_set %&gt;%
              filter(Embarked != &quot;&quot;) %&gt;%
              group_by(Embarked) %&gt;%
              summarise(CohortSize = n(),
                        SurvivalRate = sum(Survived)/n()) %&gt;%
              mutate(
                Port = ifelse(Embarked == &quot;C&quot;,&quot;Cherbough&quot;,
                              ifelse(Embarked == &quot;Q&quot;,&quot;Queenstown&quot;,&quot;Southampton&quot;)),
                Lat = ifelse(Embarked == &quot;C&quot;,49.645009,
                      ifelse(Embarked == &quot;Q&quot;,51.851,50.9038684)),
                Lng = ifelse(Embarked == &quot;C&quot;,-1.62444,
                      ifelse(Embarked == &quot;Q&quot;,-8.2967,-1.4176118 ))
              )


# Create Color Palette
col_grad &lt;- colorRamp(c(get_color(&quot;red&quot;),get_color(&quot;yellow&quot;), get_color(&quot;green&quot;)))
col_limits &lt;- c(0.4,0.6)
colpal &lt;- function(x) {
            col_list &lt;- col_grad((min(max(x,col_limits[1]),col_limits[2])-col_limits[1])/(col_limits[2]-col_limits[1]))
            rgb(col_list[1],col_list[2],col_list[3], maxColorValue= 255)
          }
size_range &lt;- c(10,15)

# Create Marker Icon
tit_icon &lt;- awesomeIcons(
            icon = &#39;ship&#39;,
            iconColor = &#39;#FFFFFF&#39;,
            library = &#39;fa&#39;,
            markerColor = &#39;gray&#39;
          )

# Create Map
map &lt;- leaflet(width = &quot;100%&quot;) %&gt;%
       addProviderTiles(&quot;CartoDB.Positron&quot;) %&gt;%
        # Location of Titanic Crash
        addAwesomeMarkers(-50.2333324,41.7666636, icon=tit_icon,popup=&quot;Titanic Crash Site&quot;)

pwalk(
  list(embark_set$Port, embark_set$Lat, embark_set$Lng, embark_set$SurvivalRate, embark_set$CohortSize),
  function(port_name, lat, lng, srate, cohort) {
    map &lt;&lt;- map %&gt;%
            addCircleMarkers(lng, lat,
                             popup=paste0(port_name, &quot;&lt;br&gt;&quot;,&quot;Survival Likelihood: &quot;,round(srate*100),&quot;%&quot;),
                             color = colpal(srate),
                             radius = max(min(cohort/20, size_range[2]),size_range[1]),
                             opacity = 0.8,
                             fillOpacity = 0.5)
  }
)

map</code></pre>
<div id="htmlwidget-180752e22a48f47234b0" style="width:100%;height:288px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-180752e22a48f47234b0">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",null,null,{"errorTileUrl":"","noWrap":false,"zIndex":null,"unloadInvisibleTiles":null,"updateWhenIdle":null,"detectRetina":false,"reuseTiles":false}]},{"method":"addAwesomeMarkers","args":[41.7666636,-50.2333324,{"icon":"ship","markerColor":"gray","iconColor":"#FFFFFF","spin":false,"squareMarker":false,"iconRotate":0,"font":"monospace","prefix":"fa"},null,null,{"clickable":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},"Titanic Crash Site",null,null,null,null,null,null]},{"method":"addCircleMarkers","args":[49.645009,-1.62444,10,null,null,{"lineCap":null,"lineJoin":null,"clickable":true,"pointerEvents":null,"className":"","stroke":true,"color":"#94A162","weight":5,"opacity":0.8,"fill":true,"fillColor":"#94A162","fillOpacity":0.5,"dashArray":null},null,null,"Cherbough<br>Survival Likelihood: 55%",null,null,null,null]},{"method":"addCircleMarkers","args":[51.851,-8.2967,10,null,null,{"lineCap":null,"lineJoin":null,"clickable":true,"pointerEvents":null,"className":"","stroke":true,"color":"#B55C5C","weight":5,"opacity":0.8,"fill":true,"fillColor":"#B55C5C","fillOpacity":0.5,"dashArray":null},null,null,"Queenstown<br>Survival Likelihood: 39%",null,null,null,null]},{"method":"addCircleMarkers","args":[50.9038684,-1.4176118,15,null,null,{"lineCap":null,"lineJoin":null,"clickable":true,"pointerEvents":null,"className":"","stroke":true,"color":"#B55C5C","weight":5,"opacity":0.8,"fill":true,"fillColor":"#B55C5C","fillOpacity":0.5,"dashArray":null},null,null,"Southampton<br>Survival Likelihood: 34%",null,null,null,null]}],"limits":{"lat":[41.7666636,51.851],"lng":[-50.2333324,-1.4176118]}},"evals":[],"jsHooks":[]}</script>
<p><br> At first glance, there seems to be no plausible explanation why a passenger’s port of embarkation will have an impact on the passenger’s survival likelihood.</p>
<pre class="r"><code># Assessing the correlation between Embarkation and Passenger Class

embark_pclass &lt;- training_set %&gt;%
                 select(Pclass, Embarked, Survived) %&gt;%
                 filter(Embarked != &quot;&quot;) %&gt;%
                 group_by(Pclass, Embarked) %&gt;%
                 summarise(CohortSize=n(),
                           SurvivalRate=sum(Survived)/n())
embark_pclass &lt;- embark_pclass %&gt;%
                 left_join(embark_pclass %&gt;% group_by(Embarked) %&gt;% summarise(TotalSize = sum(CohortSize)), by=c(&quot;Embarked&quot;)) %&gt;%
                 mutate(PctEmbarked = CohortSize / TotalSize) %&gt;%
                 arrange(Pclass, desc(PctEmbarked))
embark_pclass$Embarked &lt;- factor(embark_pclass$Embarked, levels=unique(embark_pclass$Embarked))
embark_pclass$Pclass &lt;- factor(embark_pclass$Pclass, levels=rev(unique(embark_pclass$Pclass)))

embark_pclass_plot &lt;- ggplot(embark_pclass, aes(x=as.factor(Embarked),
                                                y=PctEmbarked,
                                                fill = as.factor(Pclass))) +
                      theme_lk() + 
                  ########### LEGENDS ###########
                  scale_fill_manual(name = &quot;Passenger Class&quot;,
                     labels = c(&quot;1&quot;=&quot;1 (High-Income)&quot;,&quot;2&quot;=&quot;2 (Medium-Income)&quot;,&quot;3&quot;=&quot;3 (Low-Income)&quot;),
                     values = c(&quot;1&quot;=get_color(&quot;green&quot;),
                                &quot;2&quot;=alpha(get_color(&quot;yellow&quot;),0.2),
                                &quot;3&quot;=alpha(get_color(&quot;red&quot;),0.2)),
                     guide = guide_legend(reverse = TRUE)) +
                  ########### X-AXIS ###########
                  xlab(&quot;Port of Embarkation&quot;) +
                  scale_x_discrete(labels=c(&quot;S&quot;=&quot;Southampton&quot;,
                                            &quot;C&quot;=&quot;Cherbough&quot;,
                                            &quot;Q&quot;=&quot;Queenstown&quot;)) +
                  ########### Y-AXIS ###########
                  ylab(&quot;Survival Likelihood&quot;) +
                  scale_y_continuous(labels = scales::percent,
                                     # Make Sure Bar and X-Axis Stick Together
                                     expand = c(0,0),
                                     limits =c(0,1)) +
                  ########### FLIP TO HORIZONTAL BAR CHART ###########
                  coord_flip() +
                  ########### ELEMENTS ###########
                  # Actual Data
                  geom_bar(stat=&quot;identity&quot;) +
                  geom_text(aes(label=paste0(round(PctEmbarked*100),&quot;%&quot;),
                                y = PctEmbarked + 0.05),
                            data = embark_pclass %&gt;% filter(Pclass == 1),
                            color = get_color(&quot;green&quot;),
                            family = def_font, size = 5)

embark_pclass_plot</code></pre>
<p><img src="index_files/figure-html/exp_hypo8_p2-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>However, by studying the demographics of the passengers who embarked at each port, we know that a higher proportion of Cherbough are high-income. This explains the higher survival likelihood for those who embarked at Cherbough, and renders the hypothesis to be <span class="hl red-text">FALSE</span>.</p>
</section>
</section>
</section>
<section id="preparation" class="level2">
<h2>Preparation</h2>
<p>Based on the above hypotheses, we will be adding the following features to predict the survival likelihood of an individual.</p>
<table>
<thead>
<tr class="header">
<th>Feature</th>
<th>Variable Type</th>
<th>Hypotheses Supporting the Feature</th>
<th>Null Handling</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Pclass</td>
<td>Continuous</td>
<td>Hypothesis 1</td>
<td>-1</td>
</tr>
<tr class="even">
<td>Fare</td>
<td>Continuous</td>
<td>Hypothesis 1</td>
<td>-1</td>
</tr>
<tr class="odd">
<td>Sex</td>
<td>Categorical</td>
<td>Hypothesis 3</td>
<td>‘Unknown’ Category Variable</td>
</tr>
<tr class="even">
<td>Title</td>
<td>Categorical</td>
<td>Hypothesis 3</td>
<td>‘Unknown’ Category Variable</td>
</tr>
<tr class="odd">
<td>Age</td>
<td>Continuous</td>
<td>Hypothesis 4</td>
<td>Regression</td>
</tr>
<tr class="even">
<td>SibSp</td>
<td>Continuous</td>
<td>Hypothesis 5</td>
<td>-1</td>
</tr>
<tr class="odd">
<td>Parch</td>
<td>Continuous</td>
<td>Hypothesis 5</td>
<td>-1</td>
</tr>
<tr class="even">
<td>CabinFloor</td>
<td>Categorical</td>
<td>Hypothesis 6</td>
<td>‘Unknown’ Category Variable</td>
</tr>
<tr class="odd">
<td>CabinNumber</td>
<td>Categorical</td>
<td>Hypothesis 6</td>
<td>‘Unknown’ Category Variable</td>
</tr>
<tr class="even">
<td>Port of Embarkation</td>
<td>Categorical</td>
<td>Hypothesis 7</td>
<td>‘Unknown’ Category Variable</td>
</tr>
</tbody>
</table>
<p>Below is an example of the cleansed data set for model ingestion.</p>
<pre class="r"><code>### Create Age as Regression Parameters
age_data &lt;- training_set %&gt;%
            appendTitle() %&gt;%
            filter(Age &gt; 0)
age_m &lt;- lm(Age ~ Title + SibSp + Parch + factor(Pclass), data = age_data)

clean_data &lt;- function(data,is_training = TRUE) {
  output &lt;- appendTitle(data) %&gt;%
            appendCabinInfo()

  # Populate Age
  output &lt;- output %&gt;%
            mutate(AgePredict = predict.lm(age_m, output),
                   Age = ifelse(is.na(Age),AgePredict,Age))

  # Create Null Handler
  null_handler &lt;- function(is_categorical = TRUE) {
    paste0(&#39;ifelse(is.na(x) | x %in% c(&quot;&quot;,&quot;NA&quot;),&#39;, ifelse(is_categorical,&#39;&quot;Unknown&quot;&#39;,&#39;-1&#39;),&#39;,x)&#39;)

  }

  # Specify Features
  features &lt;- c(&quot;Pclass&quot;=FALSE,
                &quot;Fare&quot;=FALSE,
                &quot;Sex&quot;=TRUE,
                &quot;Title&quot;=TRUE,
                &quot;Age&quot;=FALSE,
                &quot;SibSp&quot;=FALSE,
                &quot;Parch&quot;=FALSE,
                &quot;CabinFloor&quot;=TRUE,
                &quot;CabinNumber&quot;=TRUE,
                &quot;Embarked&quot;=TRUE)
  mutate_fn &lt;- sapply(1:length(features), function(x) {
                paste0(&quot;sapply(&quot;,names(features[x]),&quot;, function(x) { &quot;,null_handler(features[x]),&quot; })&quot;)
              })

  output &lt;- output %&gt;%
            mutate_(
              .dots= setNames(mutate_fn, names(features))
            )

  # Specify factors for different features
  output$Sex &lt;- factor(output$Sex, levels = c(&quot;male&quot;,&quot;female&quot;,&quot;Unknown&quot;))
  output$Title &lt;- factor(output$Title, levels = c(&quot;Mr&quot;,&quot;Mrs&quot;,&quot;Miss&quot;,&quot;Master&quot;,&quot;Rare Title / M&quot;,&quot;Rare Title / F&quot;))
  output$CabinFloor &lt;- factor(output$CabinFloor, levels = c(&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;,&quot;E&quot;,&quot;F&quot;,&quot;G&quot;,&quot;T&quot;,&quot;Multiple&quot;,&quot;Unknown&quot;))
  output$CabinNumber &lt;- factor(output$CabinNumber, levels = c(&quot;Odd&quot;,&quot;Even&quot;,&quot;Mixed&quot;,&quot;Unknown&quot;))
  output$Embarked &lt;- factor(output$Embarked, levels = c(&quot;S&quot;,&quot;C&quot;,&quot;Q&quot;,&quot;Unknown&quot;))
  if (is_training) {
    output$Survived &lt;- factor(output$Survived, levels = c(0,1))
  }

  # Specify columns to extract
  if(is_training) {
    columns &lt;- c(&quot;Survived&quot;=TRUE,features)
  } else {
    columns &lt;- features
  }

  output %&gt;% select_(.dots=names(columns))
}

cleaned_set &lt;- clean_data(training_set)

pander(head(cleaned_set))</code></pre>
<table style="width:96%;">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 12%" />
<col style="width: 11%" />
<col style="width: 12%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Survived</th>
<th style="text-align: center;">Pclass</th>
<th style="text-align: center;">Fare</th>
<th style="text-align: left;">Sex</th>
<th style="text-align: left;">Title</th>
<th style="text-align: center;">Age</th>
<th style="text-align: center;">SibSp</th>
<th style="text-align: center;">Parch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">7.25</td>
<td style="text-align: left;">male</td>
<td style="text-align: left;">Mr</td>
<td style="text-align: center;">22</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">71.28</td>
<td style="text-align: left;">female</td>
<td style="text-align: left;">Mrs</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">7.925</td>
<td style="text-align: left;">female</td>
<td style="text-align: left;">Miss</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">53.1</td>
<td style="text-align: left;">female</td>
<td style="text-align: left;">Mrs</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">8.05</td>
<td style="text-align: left;">male</td>
<td style="text-align: left;">Mr</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">8.458</td>
<td style="text-align: left;">male</td>
<td style="text-align: left;">Mr</td>
<td style="text-align: center;">29.87</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<table style="width:51%;">
<colgroup>
<col style="width: 18%" />
<col style="width: 19%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">CabinFloor</th>
<th style="text-align: left;">CabinNumber</th>
<th style="text-align: left;">Embarked</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">Odd</td>
<td style="text-align: left;">C</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">Odd</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="even">
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Q</td>
</tr>
</tbody>
</table>
</section>
<section id="the-random-forest-model" class="level2">
<h2>The <i>Random Forest</i> Model</h2>
<p>Listed below are the preliminary results from the initial run using the Random Forest model.</p>
<pre class="r"><code>set.seed(1)
rf_model &lt;- randomForest(Survived ~ .,
                         data = cleaned_set,
                         importance=TRUE,
                         ntree=2000)

rf_model</code></pre>
<pre><code>## 
## Call:
##  randomForest(formula = Survived ~ ., data = cleaned_set, importance = TRUE,      ntree = 2000) 
##                Type of random forest: classification
##                      Number of trees: 2000
## No. of variables tried at each split: 3
## 
##         OOB estimate of  error rate: 16.84%
## Confusion matrix:
##     0   1 class.error
## 0 492  57   0.1038251
## 1  93 249   0.2719298</code></pre>
<pre class="r"><code>importance(rf_model)</code></pre>
<pre><code>##                    0          1 MeanDecreaseAccuracy MeanDecreaseGini
## Pclass      47.21663 47.4942132             69.39251         28.07819
## Fare        43.19055 43.9893907             66.67144         58.87971
## Sex         42.24730 36.8114966             42.57382         50.52881
## Title       54.59914 57.1290385             60.72891         77.20460
## Age         34.58641 39.4252418             53.95813         52.61366
## SibSp       44.09189  0.8302836             42.35741         18.13917
## Parch       11.04993  9.5437824             15.49590         10.00568
## CabinFloor  24.50409  6.9765507             27.03299         21.64158
## CabinNumber 17.25665 14.8254202             23.33504         12.55936
## Embarked    17.95344 29.6962125             35.40686         10.48846</code></pre>
<pre class="r"><code>p_y &lt;- predict(rf_model, newdata = cleaned_set %&gt;% select(-Survived))
err_out &lt;-  cleaned_set %&gt;%
            mutate(p_y = p_y) %&gt;%
            filter(Survived != p_y)
  
pander(head(err_out))</code></pre>
<table style="width:96%;">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 12%" />
<col style="width: 11%" />
<col style="width: 12%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Survived</th>
<th style="text-align: center;">Pclass</th>
<th style="text-align: center;">Fare</th>
<th style="text-align: left;">Sex</th>
<th style="text-align: left;">Title</th>
<th style="text-align: center;">Age</th>
<th style="text-align: center;">SibSp</th>
<th style="text-align: center;">Parch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">13</td>
<td style="text-align: left;">male</td>
<td style="text-align: left;">Mr</td>
<td style="text-align: center;">32.99</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">31.39</td>
<td style="text-align: left;">female</td>
<td style="text-align: left;">Mrs</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">7.229</td>
<td style="text-align: left;">male</td>
<td style="text-align: left;">Mr</td>
<td style="text-align: center;">29.87</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">0</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">21</td>
<td style="text-align: left;">female</td>
<td style="text-align: left;">Mrs</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">35.5</td>
<td style="text-align: left;">male</td>
<td style="text-align: left;">Mr</td>
<td style="text-align: center;">41.48</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">9.5</td>
<td style="text-align: left;">male</td>
<td style="text-align: left;">Mr</td>
<td style="text-align: center;">29</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<table style="width:60%;">
<colgroup>
<col style="width: 18%" />
<col style="width: 19%" />
<col style="width: 15%" />
<col style="width: 6%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">CabinFloor</th>
<th style="text-align: left;">CabinNumber</th>
<th style="text-align: left;">Embarked</th>
<th style="text-align: left;">p_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">S</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">S</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">S</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">Even</td>
<td style="text-align: left;">S</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">S</td>
<td style="text-align: left;">0</td>
</tr>
</tbody>
</table>
</section>
<section id="predictive-results" class="level2">
<h2>Predictive Results</h2>
</section>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
