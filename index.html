<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Lemuel Kumarga" />


<title>Estimating Survival Rate of Titanic Passengers</title>

<script src="index_files/jquery-1.12.4/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/navigation-1.1/codefolding.js"></script>
<link href="index_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="index_files/highlightjs-9.12.0/highlight.js"></script>
<script src="index_files/htmlwidgets-0.9/htmlwidgets.js"></script>
<link href="index_files/leaflet-0.7.7/leaflet.css" rel="stylesheet" />
<script src="index_files/leaflet-0.7.7/leaflet.js"></script>
<link href="index_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<link href="index_files/leaflet-label-0.2.2/leaflet.label.css" rel="stylesheet" />
<script src="index_files/leaflet-label-0.2.2/leaflet.label.js"></script>
<script src="index_files/Proj4Leaflet-0.7.2/proj4-compressed.js"></script>
<script src="index_files/Proj4Leaflet-0.7.2/proj4leaflet.js"></script>
<script src="index_files/leaflet-binding-1.1.0/leaflet.js"></script>
<script src="index_files/leaflet-providers-1.0.27/leaflet-providers.js"></script>
<script src="index_files/leaflet-providers-plugin-1.1.0/leaflet-providers-plugin.js"></script>
<link href="index_files/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.css" rel="stylesheet" />
<script src="index_files/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.min.js"></script>
<link href="index_files/fontawesome-4.7.0/font-awesome.min.css" rel="stylesheet" />
<script src="shared/js/popover.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="../../shared/css/definitions.css" />
<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="../../shared/css/definitions.css" />
<link rel="stylesheet" href="../../shared/css/general.css" />
<link rel="stylesheet" href="shared/css/Rmd.css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>






<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Estimating Survival Rate of Titanic Passengers</h1>
<h4 class="author"><em><span class="meta">Lemuel Kumarga</span></em></h4>
<h4 class="date"><em><span class="meta">Feb 2018</span></em></h4>

</div>


<section id="problem-description" class="level2">
<h2>Problem Description</h2>
<p>Set for its maiden voyage in 1912, RMS Titanic was then considered unsinkable due to its robust structure. After picking up passengers in Southampton, Cherbourg and Queenstown, the ship set sail towards New York. It was on their way there that the Titanic met its calamitous fate, crashing into an Iceberg and rendering more than 50% of the passengers lost.</p>
<p>There were many question marks concerning the events leading to and during the disaster. One of these was the evacuation process of the passengers. By analyzing personal details and disaster outcomes (survival/lost), we aim to <b>discover the various factors affecting passengers’ survival likelihoods.</b></p>
<p><span class="color-1-text">FYI: This problem was posed as an introductory challenge in <a href="https://www.kaggle.com/c/titanic" target="_blank">Kaggle</a>. The passengers are divided into two groups, one for training and the other for testing. The former contains both the passengers’ personal details and outcomes, while the latter only contains personal informaion. The aim of the project is to develop a robust model through the training set, and predict the survival of passengers in the testing set.</span></p>
<p>To skip the methodology and proceed directly to the summary of results, click <a href="#summary-of-results">here</a>.</p>
</section>
<section id="preliminaries" class="level2">
<h2>Preliminaries</h2>
<p>First load the necessary packages for this exercise.</p>
<pre class="r"><code># Load default settings for R Markdown -- see file for more details
source(&quot;shared/defaults.R&quot;)
# Load some helper functions
source(&quot;shared/helper.R&quot;)

options(stringsAsFactors = FALSE)
packages &lt;- c(&quot;dplyr&quot;,&quot;ggplot2&quot;,&quot;randomForest&quot;,&quot;tidyr&quot;,&quot;leaflet&quot;,&quot;purrr&quot;,&quot;grDevices&quot;,&quot;pander&quot;)
load_or_install.packages(packages)

data_dir &lt;- &quot;data/&quot;
output_dir &lt;- &quot;output/&quot;

si &lt;- sessionInfo()
base_pkg_str &lt;- paste0(&quot;Base Packages: &quot;,paste(si[[&quot;basePkgs&quot;]], collapse=&quot;, &quot;))
attached_pkg_str &lt;- paste0(&quot;Attached Packages: &quot;,paste(names(si[[&quot;otherPkgs&quot;]]), collapse=&quot;, &quot;))
cat(paste0(base_pkg_str,&quot;\n&quot;,attached_pkg_str))</code></pre>
<pre><code>## Base Packages: stats, graphics, grDevices, utils, datasets, base
## Attached Packages: purrr, leaflet, tidyr, randomForest, pander, ggplot2, dplyr, knitr</code></pre>
</section>
<section id="exploration" class="level2">
<h2>Exploration</h2>
<section id="about-the-data" class="level3">
<h3>About the Data</h3>
<p>We kick off by exploring the data that was provided:</p>
<pre class="r"><code>training_set &lt;- read.csv(paste0(data_dir, &quot;train.csv&quot;))

cols_summary &lt;- data_overview(training_set)

pander(cols_summary, caption=&#39;Titanic Passengers Data - For more info, please visit &lt;a href=&quot;https://www.kaggle.com/c/titanic/data&quot; target=&quot;_blank&quot;&gt;Kaggle&lt;/a&gt;&#39;)</code></pre>
<div class="table-responsive"><table style="width:96%;">
<caption>Titanic Passengers Data - For more info, please visit <a href="https://www.kaggle.com/c/titanic/data" target="_blank">Kaggle</a> <br></caption>
<colgroup>
<col style="width: 19%" />
<col style="width: 16%" />
<col style="width: 44%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ColumnNames</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Examples</th>
<th style="text-align: left;">PctFilled</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PassengerId</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">1 // 2 // 3 // 4 // 5</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Survived</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">0 // 1</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pclass</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">3 // 1 // 2</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">Braund, Mr. Owen Harris // Cumings, Mrs. John Bradley (Florence Briggs Thayer) // Heikkinen, Miss. Laina // Futrelle, Mrs. Jacques Heath (Lily May Peel) // Allen, Mr. William Henry</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sex</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">male // female</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age</td>
<td style="text-align: left;">NUMERIC</td>
<td style="text-align: left;">22 // 38 // 26 // 35 // 54</td>
<td style="text-align: left;">80%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SibSp</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">1 // 0 // 3 // 4 // 2</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parch</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">0 // 1 // 2 // 5 // 3</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ticket</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">A/5 21171 // PC 17599 // STON/O2. 3101282 // 113803 // 373450</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fare</td>
<td style="text-align: left;">NUMERIC</td>
<td style="text-align: left;">7.25 // 71.2833 // 7.925 // 53.1 // 8.05</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cabin</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">C85 // C123 // E46 // G6 // C103</td>
<td style="text-align: left;">22%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Embarked</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">S // C // Q</td>
<td style="text-align: left;">99%</td>
</tr>
</tbody>
</table></div>
<p>Based on the above table, we know that:</p>
<ul>
<li><span class="hl color-1-text">Names</span> are aggregated in the following format: <span class="hl color-2-text">Last_Name, Title First_Name</span>.</li>
<li><span class="hl color-1-text">Passenger class (Pclass) </span> levels are the equivalent of <span class="hl color-2-text">First Class (1), Business Class (2) and Economy Class (3)</span>.</li>
<li><span class="hl color-1-text">Age</span> has missing data to be populated.</li>
<li><span class="hl color-1-text">Cabin</span> data is sparse, and hence we may want to exclude this for the prediction model.</li>
</ul>
</section>
<section id="preliminary-insights" class="level3">
<h3>Preliminary Insights</h3>
<div class="st">
Insight 1: Wealthy individuals are more likely to survive.
</div>
<p>Using passenger class as a proxy for wealth, we calculated the <a data-toggle="popover" title="Survival Likelihood" data-content="% of passengers in the group who survived
.">survival likelihood</a> of each class.</p>
<pre class="r"><code>income_set &lt;- training_set %&gt;%
              group_by(Pclass) %&gt;%
              summarise(CohortSize = n(),
                        SurvivalRate = sum(Survived)/n())

income_plot &lt;-  ggplot(income_set, aes(x=SurvivalRate,
                                      y = 0,
                                      color=as.factor(Pclass),
                                      size=CohortSize)) +
                theme_lk() +
                theme(plot.margin = unit(c(0,0,0,-40),&#39;pt&#39;)) +
                # Legends
                theme(
                  legend.position = c(0.5,0.2),
                  legend.box.just = c(0.5,0.5),
                  legend.justification = c(0.5,0.5)
                ) +
                scale_color_manual(name = &quot;Passenger Class&quot;,
                                  labels = c(&quot;1&quot;=&quot;1 (High-Income)&quot;,&quot;2&quot;=&quot;2 (Medium-Income)&quot;,&quot;3&quot;=&quot;3 (Low-Income)&quot;),
                                  values = c(&quot;1&quot;=as.character(get_color(&quot;green&quot;)),
                                             &quot;2&quot;=as.character(get_color(&quot;green&quot;,0.5)),
                                             &quot;3&quot;=as.character(get_color(&quot;red&quot;))),
                                  guide = guide_legend(order = 1,
                                                       direction = &quot;vertical&quot;,
                                                       override.aes=list(size=5))) +
               scale_size_continuous(name = &quot;Cohort Size&quot;,
                                     range = c(5,20),
                                     guide = guide_legend(order = 2,
                                                          override.aes = list(alpha=0.5))) +
               # X Axis
                theme(
                  axis.line.x = element_line(colour=NA),
                  axis.ticks.x = element_line(colour=NA),
                  axis.title.x = element_blank(),
                  axis.text.x = element_blank()
                ) +
               geom_segment(data = data.frame(1),
                            aes(x=0.2, xend=0.7, y=0, yend=0),
                            size = 0.5,
                            color=ltxt_color,
                            arrow = arrow(length = unit(10,&quot;pt&quot;),
                                          type = &quot;closed&quot;)) +
               geom_text(data = data.frame(1),
                         label = &quot;Survival Likelihood&quot;,
                         x = 0.7,
                         y = 0.02,
                         family = def_font,
                         color = ltxt_color,
                         size = 5,
                         hjust = 1) +
               # Y Axis
                theme(
                  axis.line.y = element_line(colour=NA),
                  axis.ticks.y = element_line(colour=NA),
                  axis.title.y = element_blank(),
                  axis.text.y = element_blank()
                ) +
               scale_y_continuous(limits=c(-0.12, 0.05)) +
               # Elements
                geom_point() +
                geom_text(aes(y = -0.03, label=paste0(round(SurvivalRate*100,0),&quot;%&quot;)),
                          size=4,
                          color=txt_color,
                          family=def_font)

income_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The chart above shows that the more premium the class, the more likely passengers were to survive. One reason explaining this could be that 1st class passengers were first in line to access the lifeboats, while 3rd class passengers were left to fend for themselves.</p>
<pre class="r"><code>fares_set &lt;- training_set %&gt;% 
             select(Fare, Pclass, Survived)

rows_p_fare_bin &lt;- 100
fares_pdata &lt;- fares_set %&gt;%
               arrange(Fare) %&gt;%
               mutate(Group = as.integer((row_number() - 1) / rows_p_fare_bin)+1) %&gt;%
               group_by(Group) %&gt;%
               summarise(FareMax = min(Fare),
                         Survived = sum(Survived),
                         CohortSize = n()) %&gt;%
               mutate(SurvivalRate = Survived / CohortSize)
fares_pdata &lt;- rbind(fares_pdata, c(0,0,0,0,0), c(max(fares_pdata$Group)+1,max(fares_set$Fare),0,0,0)) %&gt;%
               arrange(Group)

fares_plot &lt;- ggplot(fares_pdata, aes(x = FareMax,
                                      y = SurvivalRate)) +
              theme_lk() +
              xlab(&quot;Passenger Fares&quot;) +
              scale_x_continuous(labels = scales::dollar) +
              ylab(&quot;Survival Likelihood&quot;) +
              scale_y_continuous(labels = scales::percent) +
              geom_step(color = get_color(1))

fares_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Similarly, we also noticed this phenomenon in fares. Passengers who were paying more have a higher survival likelihood than others.</p>
<div class="st">
Insight 2: Females and more esteemed individuals are more likely to survive than males.
</div>
<p>The data provides us with a list of titles under the <span class="hl">Name</span> column. Each title is associated with a gender (with the exception of one), as shown below:</p>
<pre class="r"><code>prefix &lt;- function(x) { unlist(strsplit(unlist(strsplit(x, &quot;, &quot;))[2],&quot;\\. &quot;))[1] }

gender_set &lt;- training_set %&gt;%
              mutate(Prefix = as.character(lapply(Name, prefix))) %&gt;%
              select(Prefix, Sex)
prefix_totals &lt;- gender_set %&gt;%
                 group_by(Prefix) %&gt;%
                 summarise(total = n())
gender_sex_totals &lt;- gender_set %&gt;%
                     group_by(Prefix, Sex) %&gt;%
                     summarise(val=n()) %&gt;%
                     left_join(prefix_totals, by=c(&quot;Prefix&quot;)) %&gt;%
                     mutate(
                       pct = ifelse(Sex == &quot;female&quot;,1.,-1.) * val / total
                     ) %&gt;%
                     arrange(desc(val))
gender_sex_totals$Prefix &lt;- substr(gender_sex_totals$Prefix,1,4)
gender_sex_totals$Prefix &lt;- factor(gender_sex_totals$Prefix, levels=unique(gender_sex_totals$Prefix))

gender_plot &lt;- ggplot(gender_sex_totals, aes(x = Prefix,
                                             y = Sex,
                                             fill = Sex,
                                             alpha = val)) +
               theme_lk() +
               scale_fill_manual(values=c(&quot;female&quot;=as.character(get_color(&quot;red&quot;)),
                                           &quot;male&quot;=as.character(get_color(&quot;blue&quot;))),
                                    guide = &quot;none&quot;) +
               scale_alpha_continuous(limits = c(0,25),
                                       range = c(0.3,1),
                                       name = &quot;Cohort Size&quot;,
                                       guide = guide_legend(
                                         nrow = 1,
                                         override.aes=list(fill=ltxt_color)
                                       )) +
                xlab(&quot;Title&quot;) +
                scale_x_discrete(expand = c(0, 0)) +
                scale_y_discrete(expand = c(0, 0),
                                 labels = c(&quot;female&quot;=&quot;F&quot;,&quot;male&quot;=&quot;M&quot;)) +
                ylab(&quot;Gender&quot;) +
                geom_tile(colour = bg_color, size = 5)

gender_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Other than <span class="hl color-1-text">Mr, Miss, Mrs and Master</span>, all other titles are not common to the average passenger. To navigate the small sample size, we will group all of these other titles under <span class="hl color-2-text">Rare Title</span>.</p>
<p>With the following modifications, we can then assess the survival likelihood of each title and gender:</p>
<pre class="r"><code>appendTitle &lt;- function(data) {
  data %&gt;%
  mutate(Title = as.character(lapply(Name, prefix))) %&gt;%
  mutate(Title = ifelse(Title %in% c(&quot;Mr&quot;,&quot;Mrs&quot;,&quot;Miss&quot;,&quot;Master&quot;), Title,
                        ifelse(Sex == &quot;male&quot;,&quot;Rare Title / M&quot;, &quot;Rare Title / F&quot;)))
}

title_set &lt;- appendTitle(training_set) %&gt;%
             select(Title, Sex, Survived) %&gt;%
             group_by(Title, Sex) %&gt;%
             summarise(survive = sum(Survived) / n()) %&gt;%
             arrange(desc(survive))

title_set$Title &lt;- factor(title_set$Title, levels=c(title_set$Title))

title_plot &lt;- ggplot(title_set, aes(x=Title,
                                    y=survive,
                                    fill=Sex)) +
              theme_lk() +
              scale_fill_manual(name = &quot;Gender&quot;,
                                  label = c(&quot;male&quot;=&quot;Male&quot;, &quot;female&quot;=&quot;Female&quot;),
                                  values = c(&quot;male&quot;= as.character(get_color(&quot;blue&quot;)),
                                             &quot;female&quot; = as.character(get_color(&quot;red&quot;))),
                                   guide = guide_legend()) +

              xlab(&quot;Title&quot;) +
              ylab(&quot;Survival Likelihood&quot;) +
              scale_y_continuous(labels = scales::percent,
                                 # Make Sure Bar and X-Axis Stick Together
                                 expand = c(0,0)) +
              geom_bar(stat=&quot;identity&quot;,
                       width = .5) +
              geom_text(aes(y = survive - 0.08,
                            label=paste0(round(survive*100),&quot;%&quot;)),
                        color = &quot;#FFFFFF&quot;,
                        family=def_font,
                        size=4)
  
title_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><span class="hl">All</span> females, regardless of their titles, have higher survival likelihoods than males. In addition, having a title other than Mrs, Miss or Mr, elevates the survival likelihood of the individual. One reason explaining this could be that females and esteemed individuals were given early access to escape the Titanic.</p>
<div class="st">
Insight 3: The younger the passenger, the more likely he/she will survive.
</div>
<p>The chart below shows how survival likelihood changes with age.</p>
<pre class="r"><code>age_set &lt;- training_set %&gt;%
           select(Age, Survived) %&gt;%
           filter(Age &gt; 0)

rows_p_age_bin &lt;- 50
age_pdata &lt;- age_set %&gt;%
                 arrange(Age) %&gt;%
                 mutate(Group = as.integer((row_number() - 1)/rows_p_age_bin) + 1) %&gt;%
                 group_by(Group) %&gt;%
                 summarise(AgeMin = min(Age),
                           Survived = sum(Survived),
                           CohortSize = n(),
                           SurviveL = Survived/CohortSize)
age_pdata &lt;- rbind(age_pdata,
                   c(0,0,0,0,0),
                   c(max(age_pdata$Group)+1,max(age_set$Age),0,0,0)) %&gt;%
             arrange(Group)

age_plot &lt;- ggplot(age_pdata, aes(x=AgeMin,
                                      y=SurviveL)) +
            theme_lk() +
            xlab(&quot;Age&quot;) +
            scale_x_continuous(breaks=seq(0,max(age_pdata$AgeMin),by=10)) +
            ylab(&quot;Survival Likelihood&quot;) +
            scale_y_continuous(labels = scales::percent,
                               expand = c(0.4, -0.15)) +
                  # Actual Data
                  geom_step(color=get_color(1)) +
                  geom_vline(data = age_pdata %&gt;%
                                    filter(row_number() %in% c(3,16)),
                             aes(xintercept = AgeMin),
                             linetype = &quot;dashed&quot;,
                             color = ltxt_color) +
                  geom_text(data = age_pdata %&gt;%
                                   filter(row_number() %in% c(3,16)),
                            aes(x = AgeMin + 8.5, label = paste(AgeMin, &quot;Years Old&quot;)),
                            y = max(age_pdata$SurviveL),
                            color = ltxt_color,
                            size = 5,
                            family = def_font)
  
age_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Among those passengers whose age were populated, we can see that younger individuals are more likely to survive. One possible explanation could be because babies and toddlers occupy less space (and hence easier to find seats within the lifeboats).</p>
<p>However, older people, especially those more than 60 years old, are less likely to survive. This is probably due to their lack of agility in responding to the crash.</p>
<div class="st">
Insight 4: An individual is more likely to survive if he/she has other family members with him/her.
</div>
<p>Typically, we would expect that the more family members, the more spaces the family unit would need in the lifeboat, hence reducing the survival probability of each member as a whole.</p>
<p>However, contrary to expectations, the data shows that the larger the <a data-toggle="popover" title="Family Size" data-content="The number of family members on board the Titanic, including the passenger. Examples of family members include spouses, siblings, parents and children.">family size</a>, the more likely an individual will survive:</p>
<pre class="r"><code>appendFamilySize &lt;- function(data) {
    data %&gt;%
    mutate(FamilySize = Parch + SibSp + 1)
}

# Group by Family Size and calculate Survival Rates for Different Subsets of Passengers
company_set &lt;- training_set %&gt;%
               appendFamilySize() %&gt;%
               mutate(Size = FamilySize,
                      isAdult = is.na(Age) | Age &gt; 12,
                      isAdultNoChild = isAdult &amp; Parch == 0,
                      isFemaleNoChild = isAdultNoChild &amp; Sex == &quot;female&quot;) %&gt;%
               group_by(Size) %&gt;%
               summarise(CohortSize = n(),
                         SurvivalRate = sum(Survived)/CohortSize,
                         Adults = sum(isAdult),
                         SurvivalRateAdults = sum(isAdult &amp; Survived)/Adults,
                         AdultsNoChild = sum(isAdultNoChild),
                         SurvivalRateAdultsNoChild = sum(isAdultNoChild &amp; Survived)/AdultsNoChild,
                         FemaleNoChild = sum(isFemaleNoChild),
                         SurvivalRateFemaleNoChild = sum(isFemaleNoChild &amp; Survived)/FemaleNoChild)

# Normalize the survival rates with respect to baseline (Size = 0)
for (c_name in c(&quot;SurvivalRateAdults&quot;,
                 &quot;SurvivalRateAdultsNoChild&quot;,
                 &quot;SurvivalRateFemaleNoChild&quot;)) {
  company_set[,c_name] &lt;- company_set[,c_name] / as.double(company_set[1,c_name]) * as.double(company_set[1,&quot;SurvivalRate&quot;])
}

# Calculate attribution statistics
company_set$AttrChild &lt;- company_set$SurvivalRate - company_set$SurvivalRateAdults
company_set$AttrParents &lt;- company_set$SurvivalRateAdults - company_set$SurvivalRateAdultsNoChild
company_set$AttrHusband &lt;- company_set$SurvivalRateAdultsNoChild - company_set$SurvivalRateFemaleNoChild
company_set$Baseline &lt;- company_set$SurvivalRate - company_set$AttrChild - company_set$AttrParents - company_set$AttrHusband

# Only analyze cohort size until 3 due to small sample sizes afterwards
company_stack &lt;- company_set %&gt;% 
                filter(Size &lt;= 3) %&gt;% 
                select(Size, Baseline, AttrHusband, AttrParents, AttrChild, SurvivalRate) %&gt;%
                gather_(&quot;Attribution&quot;,&quot;Value&quot;,setdiff(names(.),c(&quot;Size&quot;,&quot;SurvivalRate&quot;))) %&gt;%
                mutate(Value = sapply(Value, function(x) { max(x,0) }))

# Reorder factor levels
company_stack$Attribution &lt;- factor(company_stack$Attribution, levels = rev(unique(company_stack$Attribution)))


company_plot &lt;- ggplot(company_stack, aes(x= Size, y= Value)) + 
                theme_lk() +
                scale_x_continuous(name=&quot;Family Size&quot;,
                                   expand = c(0.05,0),
                                   labels = function(i) { round(i) },
                                   breaks = 1:3) +
                scale_y_continuous(name=&quot;Survival Likelihood&quot;,
                                   expand = c(0,0),
                                   labels = scales::percent) +
                coord_cartesian(ylim=c(0.2,0.65)) +
                scale_fill_manual(name=&quot;Attribution&quot;, 
                                  labels=c(&quot;Baseline&quot;=&quot;Baseline&quot;, 
                                           &quot;AttrHusband&quot;=&quot;Husband&quot;,
                                           &quot;AttrParents&quot;=&quot;Parental&quot;,
                                           &quot;AttrChild&quot;=&quot;Child&quot;),
                                  values=c(&quot;Baseline&quot;=alpha(txt_color,0.2),
                                           &quot;AttrHusband&quot;=get_color(1,0.8),
                                           &quot;AttrParents&quot;=get_color(2,0.8),
                                           &quot;AttrChild&quot;=get_color(3,0.8)),
                                  guide=guide_legend(reverse=T)) +
                scale_color_manual(values=c(&quot;Baseline&quot;=alpha(txt_color,0),
                                            &quot;AttrHusband&quot;=get_color(1),
                                            &quot;AttrParents&quot;=get_color(2),
                                            &quot;AttrChild&quot;=get_color(3)),
                                   guide = &#39;none&#39;) + 
                geom_area(aes(fill = Attribution, colour=Attribution), size=1.5, linetype=1, position = &#39;stack&#39;) + 
                geom_text(data=unique(company_stack %&gt;% select(Size, SurvivalRate)),
                          aes(x=Size, y=SurvivalRate+0.03, label=paste0(round(SurvivalRate*100),&quot;%&quot;)),
                          color=txt_color,
                          size=5,
                          family = def_font)
  
company_plot </code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>This counterintuitive relationship can be explained through 3 factors:</p>
<ul>
<li><p><span class="hl color-3-text">Child Privilege</span>: If you have a larger family size, there is an increased probability that you are a child. For example, a family of 5 will more likely include 2 adults and 3 children, rather than 5 adults. Furthermore, from Insight 3, we know that children have higher survival likelihoods than adults. Hence, by the transitive property, it follows that: <br/><br/> Larger Family Size -&gt; More Likely To Be A Child -&gt; More Likely to Survive.<br/><br/> The benefits accrued by this privilege, shown in <span class="hl color-3-text">red</span>, can be accounted for when we compare data from all passengers against data from only the adults (&gt; 15 years old)</p></li>
<li><p><span class="hl color-2-text">Parental Privilege</span>: The larger the family size, the more likely you are to be a parent. Parents can utilize their children’s lifeboat guarantee to tag-along and get themselves a space. These benefits, which are represented in <span class="hl color-2-text">green</span>, surface when we compare the survival likelihoods of adults with children and adults with none.</p></li>
<li><p><span class="hl color-1-text">Husband Privilege</span>: As a male, having a family size of 2 and no children may guarantee you better odds since you can tag along with your wife (see Insight 2) to obtain a lifeboat seat. These benefits, shown in <span class="hl color-1-text">blue</span>, can be accounted for when we compare between males and females that do not have children.</p></li>
</ul>
<div class="st">
Insight 5: Cabin positions should have an impact of survivalhood, but only to a certain extent.
</div>
<p>Passengers staying further away from the lifeboats will have more difficult time surviving, hence we should assume that the cabin positions will have an impact on their survivalhood. However, given that passengers may not be at their cabins during the time of crash, this impact may not be significant.</p>
<p>A more detailed deck plan can be found in the <a href="https://www.encyclopedia-titanica.org/titanic-deckplans/b-deck.html" target="_blank">Encyclopedia Titanica</a>. As shown from the deck plans, the letter of the cabin represents the floor of the room, while the odd and even numbers corresponds to the left and right side of Titanic respectively.</p>
<pre class="r"><code>getCabinFloor &lt;- function(x) {

  if (x == &quot;&quot;) { return(&quot;NA&quot;) }

  ltr &lt;- unique(strsplit(gsub(&quot;[0-9]&quot;,&quot;&quot;,x),&quot; &quot;)[[1]])
  if (length(ltr) == 1) {
    ltr
  } else {
    &quot;Multiple&quot;
  }

}

getCabinNumber &lt;- function(x) {

  if (x == &quot;&quot;) { return(&quot;NA&quot;) }

  num &lt;- as.integer(strsplit(gsub(&quot;[A-z]&quot;,&quot;&quot;,x),&quot; &quot;)[[1]]) %% 2

  if (is.nan(mean(num))) {
    return(&quot;NA&quot;)
  } else if (length(unique(num)) == 1) {
    if (unique(num) == 0) { return(&quot;Even&quot;) } else { return(&quot;Odd&quot;) }
  } else {
    return(&quot;Mixed&quot;)
  }

}

getCabinCount &lt;- function(x) {
  if (x == &quot;&quot;) { return(&quot;NA&quot;) }
  length(strsplit(x,&quot; &quot;)[[1]])
}

appendCabinInfo &lt;- function(data) {
  data %&gt;%
  mutate(
    CabinFloor = sapply(Cabin, getCabinFloor),
    CabinNumber = sapply(Cabin, getCabinNumber),
    CabinCount = sapply(Cabin, getCabinCount)
  )
}

cabin_set &lt;- appendCabinInfo(training_set) %&gt;%
             select(CabinFloor,CabinNumber,CabinCount, Survived)</code></pre>
<section id="cabin-floors" class="level5">
<h5>Cabin Floors</h5>
<pre class="r"><code>cabinLet_set &lt;- cabin_set %&gt;%
                group_by(CabinFloor) %&gt;%
                summarise(CohortSize = n(),
                          SurvivalRate = sum(Survived)/n())

cabinLet_plot &lt;- ggplot(cabinLet_set, aes(x=as.factor(CabinFloor),
                                          y=SurvivalRate,
                                          alpha = CohortSize,
                                          fill = SurvivalRate)) +
                  theme_lk() + 
                  scale_alpha_continuous(name = &quot;Cohort Size&quot;,
                                         limits = c(0,30),
                                         guide = guide_legend(
                                           nrow = 1,
                                           override.aes=list(fill=ltxt_color)
                                         )) +
                  scale_fill_gradientn(colours=c(as.character(get_color(&quot;red&quot;)),
                                                 as.character(get_color(&quot;red&quot;)),
                                                 as.character(get_color(&quot;yellow&quot;)),
                                                 as.character(get_color(&quot;green&quot;)),
                                                 as.character(get_color(&quot;green&quot;))),
                                       values = c(0.0,0.4,0.5,0.6,1.0),
                                       guide = &quot;none&quot;) +
                    xlab(&quot;Cabin Floor&quot;) +
                    ylab(&quot;Survival Likelihood&quot;) +
                    scale_y_continuous(labels = scales::percent,
                                       # Make Sure Bar and X-Axis Stick Together
                                       expand = c(0,0),
                                       limits =c(0,1)) +
                    # Actual Data
                    geom_bar(stat=&quot;identity&quot;) +
                    geom_text(aes(y = SurvivalRate - 0.08,
                                  label=paste0(round(SurvivalRate*100),&quot;%&quot;)),
                              color = &quot;#FFFFFF&quot;, alpha = 1,
                              family=def_font,size=4)
  
cabinLet_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>From the chart above, we know that <span class="hl">Cabins B to E</span> has a higher likelihood of survival compared to other cabins. This implies that the position of cabins play a role in determining whether a passenger survive.</p>
</section>
<section id="cabin-numbers" class="level5">
<h5>Cabin Numbers</h5>
<pre class="r"><code>cabinNumber_set &lt;- cabin_set %&gt;%
                   group_by(CabinNumber) %&gt;%
                    summarise(CohortSize = n(),
                              SurvivalRate = sum(Survived)/n())
cabinNumber_set$CabinNumber &lt;- factor(cabinNumber_set$CabinNumber, levels=c(&quot;Even&quot;,&quot;Odd&quot;,&quot;Mixed&quot;,&quot;NA&quot;))

cabinNumber_plot &lt;- ggplot(cabinNumber_set, aes(x = SurvivalRate,
                                                y = 0,
                                                color=CabinNumber,
                                                size=CohortSize)) +
                    theme_lk() +
                    theme(plot.margin = unit(c(0,0,0,-40),&#39;pt&#39;)) +
                    # Legends
                    theme(
                      legend.position = c(0.5,0.2),
                      legend.box.just = c(0.5,0.5),
                      legend.justification = c(0.5,0.5)
                    ) +
                    scale_color_manual(name = &quot;Room Type&quot;,
                                       values = get_color(),
                                       guide = guide_legend(order = 1,
                                                            direction = &quot;vertical&quot;,
                                                            override.aes=list(size=5),
                                                            ncol= 2)) +
                    scale_size_continuous(name = &quot;Cohort Size&quot;,
                                          range = c(5,20),
                                          guide = guide_legend(order = 2,
                                                               override.aes=list(alpha=0.5))) +
                    theme(
                      axis.line.x = element_line(colour=NA),
                      axis.ticks.x = element_line(colour=NA),
                      axis.title.x = element_blank(),
                      axis.text.x = element_blank()
                    ) +
                    # Add X Axis Line
                    geom_segment(data = data.frame(1),
                                 aes(x=0.25, xend=0.8, y=0, yend=0),
                                 size = 0.5,
                                 color=alpha(ltxt_color,0.5),
                                 arrow = arrow(length = unit(10,&quot;pt&quot;),
                                               type = &quot;closed&quot;)) +
                    geom_text(data = data.frame(1),
                              label = &quot;Survival Likelihood&quot;,
                              x = 0.8,
                              y = 0.02,
                              family = def_font,
                              color = ltxt_color,
                              size = 5,
                              hjust = 1) +
                    theme(
                      # Y-Axis
                      axis.line.y = element_line(colour=NA),
                      axis.ticks.y = element_line(colour=NA),
                      axis.title.y = element_blank(),
                      axis.text.y = element_blank()) +
                      scale_y_continuous(limits=c(-0.12, 0.05)) +
                    geom_point() +
                    geom_text(aes(y = -0.03, label=paste0(round(SurvivalRate*100,0),&quot;%&quot;)),
                              size=4,
                              color=txt_color,
                              family=def_font)
  
cabinNumber_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>It is pretty clear that those who stay in the odd rooms are more likely to survive than those in the even rooms.</p>
<p>In conclusion, cabin floors and cabin numbers, when available, can determine a passenger’s survival likelihood.</p>
<div class="st">
Insight 6: Port of embarkation has an impact on survivalhood, as they are correlated with Passenger class.
</div>
<pre class="r"><code>embark_set &lt;- training_set %&gt;%
              filter(Embarked != &quot;&quot;) %&gt;%
              group_by(Embarked) %&gt;%
              summarise(CohortSize = n(),
                        SurvivalRate = sum(Survived)/n()) %&gt;%
              mutate(
                Port = ifelse(Embarked == &quot;C&quot;,&quot;Cherbough&quot;,
                              ifelse(Embarked == &quot;Q&quot;,&quot;Queenstown&quot;,&quot;Southampton&quot;)),
                Lat = ifelse(Embarked == &quot;C&quot;,49.645009,
                      ifelse(Embarked == &quot;Q&quot;,51.851,50.9038684)),
                Lng = ifelse(Embarked == &quot;C&quot;,-1.62444,
                      ifelse(Embarked == &quot;Q&quot;,-8.2967,-1.4176118 ))
              )


# Create Color Palette
col_grad &lt;- colorRamp(c(get_color(&quot;red&quot;),get_color(&quot;yellow&quot;), get_color(&quot;green&quot;)))
col_limits &lt;- c(0.4,0.6)
colpal &lt;- function(x) {
            col_list &lt;- col_grad((min(max(x,col_limits[1]),col_limits[2])-col_limits[1])/(col_limits[2]-col_limits[1]))
            rgb(col_list[1],col_list[2],col_list[3], maxColorValue= 255)
          }
size_range &lt;- c(10,15)

# Create Marker Icon
tit_icon &lt;- awesomeIcons(
            icon = &#39;ship&#39;,
            iconColor = &#39;#FFFFFF&#39;,
            library = &#39;fa&#39;,
            markerColor = &#39;gray&#39;
          )

# Create Map
map &lt;- leaflet(width = &quot;100%&quot;) %&gt;%
       addProviderTiles(&quot;CartoDB.Positron&quot;) %&gt;%
        # Location of Titanic Crash
        addAwesomeMarkers(-50.2333324,41.7666636, icon=tit_icon,popup=&quot;Titanic Crash Site&quot;)

pwalk(
  list(embark_set$Port, embark_set$Lat, embark_set$Lng, embark_set$SurvivalRate, embark_set$CohortSize),
  function(port_name, lat, lng, srate, cohort) {
    map &lt;&lt;- map %&gt;%
            addCircleMarkers(lng, lat,
                             popup=paste0(port_name, &quot;&lt;br&gt;&quot;,&quot;Survival Likelihood: &quot;,round(srate*100),&quot;%&quot;),
                             color = colpal(srate),
                             radius = max(min(cohort/20, size_range[2]),size_range[1]),
                             opacity = 0.8,
                             fillOpacity = 0.5)
  }
)

map</code></pre>
<div id="htmlwidget-baa4f9e59cd2c0474483" style="width:100%;height:268.8px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-baa4f9e59cd2c0474483">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",null,null,{"errorTileUrl":"","noWrap":false,"zIndex":null,"unloadInvisibleTiles":null,"updateWhenIdle":null,"detectRetina":false,"reuseTiles":false}]},{"method":"addAwesomeMarkers","args":[41.7666636,-50.2333324,{"icon":"ship","markerColor":"gray","iconColor":"#FFFFFF","spin":false,"squareMarker":false,"iconRotate":0,"font":"monospace","prefix":"fa"},null,null,{"clickable":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},"Titanic Crash Site",null,null,null,null,null,null]},{"method":"addCircleMarkers","args":[49.645009,-1.62444,10,null,null,{"lineCap":null,"lineJoin":null,"clickable":true,"pointerEvents":null,"className":"","stroke":true,"color":"#89942F","weight":5,"opacity":0.8,"fill":true,"fillColor":"#89942F","fillOpacity":0.5,"dashArray":null},null,null,"Cherbough<br>Survival Likelihood: 55%",null,null,null,null]},{"method":"addCircleMarkers","args":[51.851,-8.2967,10,null,null,{"lineCap":null,"lineJoin":null,"clickable":true,"pointerEvents":null,"className":"","stroke":true,"color":"#A43820","weight":5,"opacity":0.8,"fill":true,"fillColor":"#A43820","fillOpacity":0.5,"dashArray":null},null,null,"Queenstown<br>Survival Likelihood: 39%",null,null,null,null]},{"method":"addCircleMarkers","args":[50.9038684,-1.4176118,15,null,null,{"lineCap":null,"lineJoin":null,"clickable":true,"pointerEvents":null,"className":"","stroke":true,"color":"#A43820","weight":5,"opacity":0.8,"fill":true,"fillColor":"#A43820","fillOpacity":0.5,"dashArray":null},null,null,"Southampton<br>Survival Likelihood: 34%",null,null,null,null]}],"limits":{"lat":[41.7666636,51.851],"lng":[-50.2333324,-1.4176118]}},"evals":[],"jsHooks":[]}</script>
<p><br> The map above indicates that those who embarked at Cherbough are more likely to survive. This is a puzzling observation as where the passenger embarks should not have an impact of what is happening on the Titanic.</p>
<pre class="r"><code># Assessing the correlation between Embarkation and Passenger Class

embark_pclass &lt;- training_set %&gt;%
                 select(Pclass, Embarked, Survived) %&gt;%
                 filter(Embarked != &quot;&quot;) %&gt;%
                 group_by(Pclass, Embarked) %&gt;%
                 summarise(CohortSize=n(),
                           SurvivalRate=sum(Survived)/n())
embark_pclass &lt;- embark_pclass %&gt;%
                 left_join(embark_pclass %&gt;% group_by(Embarked) %&gt;% summarise(TotalSize = sum(CohortSize)), by=c(&quot;Embarked&quot;)) %&gt;%
                 mutate(PctEmbarked = CohortSize / TotalSize) %&gt;%
                 arrange(Pclass, desc(PctEmbarked))
embark_pclass$Embarked &lt;- factor(embark_pclass$Embarked, levels=unique(embark_pclass$Embarked))
embark_pclass$Pclass &lt;- factor(embark_pclass$Pclass, levels=rev(unique(embark_pclass$Pclass)))

embark_pclass_plot &lt;- ggplot(embark_pclass, aes(x=as.factor(Embarked),
                                                y=PctEmbarked,
                                                fill = as.factor(Pclass))) +
                      theme_lk() + 
                      scale_fill_manual(name = &quot;Passenger Class&quot;,
                         labels = c(&quot;1&quot;=&quot;1 (High-Income)&quot;,&quot;2&quot;=&quot;2 (Medium-Income)&quot;,&quot;3&quot;=&quot;3 (Low-Income)&quot;),
                         values = c(&quot;1&quot;=get_color(&quot;green&quot;),
                                    &quot;2&quot;=alpha(get_color(&quot;green&quot;,0.5),0.2),
                                    &quot;3&quot;=alpha(get_color(&quot;red&quot;),0.2)),
                         guide = guide_legend(reverse = TRUE)) +
                      xlab(&quot;Port of Embarkation&quot;) +
                      scale_x_discrete(labels=c(&quot;S&quot;=&quot;Southampton&quot;,
                                                &quot;C&quot;=&quot;Cherbough&quot;,
                                                &quot;Q&quot;=&quot;Queenstown&quot;)) +
                      ylab(&quot;Survival Likelihood&quot;) +
                      scale_y_continuous(labels = scales::percent,
                                         # Make Sure Bar and X-Axis Stick Together
                                         expand = c(0,0),
                                         limits =c(0,1)) +
                      coord_flip() +
                      # Actual Data
                      geom_bar(stat=&quot;identity&quot;, width=0.8) +
                      geom_text(aes(label=paste0(round(PctEmbarked*100),&quot;%&quot;),
                                    y = PctEmbarked - 0.05),
                                data = embark_pclass %&gt;% filter(Pclass == 1),
                                color = bg_color,
                                family = def_font, size = 5)

embark_pclass_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>However, by studying the demographics of the passengers embarking at each port, we discovered that a higher proportion of Cherbough are 1st class passengers. This would explain the confounding observation noted earlier.</p>
</section>
</section>
</section>
<section id="modeling-survival-likelihood" class="level2">
<h2>Modeling Survival Likelihood</h2>
<section id="rationale" class="level3">
<h3>Rationale</h3>
<p>While the preliminary insights were useful in identifying survival factors, we also need a way to quantify the importance of each factor. Building a predictive model would achieve that goal.</p>
<p>Since this is a classification problem (for each passenger, we either group them as “Survived” or “Died”), models such as logistic regression and decision trees come to mind. However, for the purposes of this study, the <a href="https://en.wikipedia.org/wiki/Random_forest" target="_blank">Random Forest</a> algorithm was used, as it is more robust and there already exists a useful function <code>importance</code> that can assess the various factors intuitively.</p>
</section>
<section id="preparation" class="level3">
<h3>Preparation</h3>
<section id="variables-considered" class="level4">
<h4>Variables Considered</h4>
<p>Based on the above insights, we will be adding the following factors to predict the survival likelihood of an individual.</p>
<div class="table-responsive"><table>
<thead>
<tr class="header">
<th>Feature</th>
<th>Variable Type</th>
<th>Insights Supporting the Feature</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Pclass</td>
<td>Continuous</td>
<td>Insight 1</td>
</tr>
<tr class="even">
<td>Fare</td>
<td>Continuous</td>
<td>Insight 1</td>
</tr>
<tr class="odd">
<td>Sex</td>
<td>Categorical</td>
<td>Insight 2</td>
</tr>
<tr class="even">
<td>Title</td>
<td>Categorical</td>
<td>Insight 2</td>
</tr>
<tr class="odd">
<td>Age</td>
<td>Continuous</td>
<td>Insight 3</td>
</tr>
<tr class="even">
<td>FamilySize</td>
<td>Continuous</td>
<td>Insight 4</td>
</tr>
</tbody>
</table></div>
<p>*Initially, CabinFloor, CabinNumber and Port of Embarkation were used as predictors of survival likelihood. However, the accuracy of the model fell with the inclusion of these features due to over-fitting. This implies that we may be over-inflating the impact of embarkation port, while the cabin data is too sparse to yield any useful information.</p>
</section>
<section id="populating-age" class="level4">
<h4>Populating Age</h4>
<p>Before inputting the raw data into a model, we have to ensure that the data is in a well-defined state. One of the fixes we need to make is to populate any unidentified <span class="hl">Age</span> values.</p>
<p>We will use the following variables as predictors of Age:</p>
<ul>
<li><p><span class="hl">Pclass</span>: 1st class members (38 years old on average) are generally older than 2nd (30) or 3rd (25) class members.</p></li>
<li><p><span class="hl">Title</span>: Masters (5 years old on average) and Misses (22) tend to be younger than Mr (32) and Mrs (36).</p></li>
<li><p><span class="hl">ConfirmedAdult</span>: This is a new category created just to predict age. Assuming that there are no intergenerational families in Titanic (i.e. an individual having both parents and children), we know that having more than 2 parent-children relationships strongly implies an individual is a parent (since a child can have a maximum of 2 parent relationships). These individuals are what we call <span class="hl">ConfirmedAdults</span>. Such passengers are 9 years older on average than the rest of the passengers.</p></li>
<li><p><span class="hl">FamilySize</span>: Based on Insight 4, we know that a larger family size implies a higher probability of being a child. In fact, the correlation between age and family size is modest at -30%.</p></li>
</ul>
<p><a data-toggle="popover" title="ANOVA Regression" data-content="A regression similar to the standard linear regression, with the added capability of having categorical values as independent variables.">ANOVA regression</a> will be used to predict Age based on the factors above.</p>
<p>Listed below is a summary of the regression.</p>
<pre class="r"><code>appendConfirmedAdult &lt;- function(data) {
    data %&gt;%
    mutate(ConfirmedAdult = ifelse(Parch &gt; 2, 1, 0))
}

age_model &lt;- function(data) {
  
  age_data &lt;- data %&gt;%
              appendTitle() %&gt;%
              appendFamilySize() %&gt;%
              appendConfirmedAdult() %&gt;%
              filter(Age &gt; 0)
  
  model &lt;- lm(Age ~ Pclass +
                    Title + 
                    ConfirmedAdult +
                    FamilySize,
              data = age_data)
  
  model
}

age_m &lt;- age_model(training_set)
summary(age_m)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Age ~ Pclass + Title + ConfirmedAdult + FamilySize, 
##     data = age_data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -24.347  -8.213  -1.152   6.295  44.647 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)          29.0606     2.8020  10.372  &lt; 2e-16 ***
## Pclass               -5.8879     0.5184 -11.357  &lt; 2e-16 ***
## TitleMiss             9.9067     2.2406   4.422 1.13e-05 ***
## TitleMr              19.9798     2.2397   8.921  &lt; 2e-16 ***
## TitleMrs             22.2223     2.3357   9.514  &lt; 2e-16 ***
## TitleRare Title / F  12.8385     4.7922   2.679  0.00756 ** 
## TitleRare Title / M  28.1837     3.3831   8.331 4.18e-16 ***
## ConfirmedAdult       16.2836     3.3101   4.919 1.08e-06 ***
## FamilySize           -2.0239     0.3600  -5.621 2.73e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.07 on 705 degrees of freedom
## Multiple R-squared:  0.426,  Adjusted R-squared:  0.4195 
## F-statistic: 65.41 on 8 and 705 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Due to our careful selection of variables, all of the coefficients are statistically significant with a 5% significance level. This suggests that the variables are all good predictors of Age.</p>
</section>
<section id="populating-others" class="level4">
<h4>Populating Others</h4>
<p>Other than age, we also need some kind of sanity checks to ensure that all data has been populated. Since the rest of columns are either too varied, or require only a small set of missing values to be filled, we will populate then with category “Unknown” or the number -1.</p>
</section>
<section id="putting-it-all-together" class="level4">
<h4>Putting It All Together</h4>
<p>After resolving the missing data, we can now create a process that takes in the raw data and output a cleansed data that is ready for model consumption.</p>
<p>Below is an example of the data after cleansing:</p>
<pre class="r"><code>clean_data &lt;- function(data, age_model, is_training = TRUE) {
  output &lt;- appendTitle(data) %&gt;%
            appendFamilySize() %&gt;%
            appendConfirmedAdult()
  
  # Populate Age
  output &lt;- output %&gt;%
            mutate(AgePredict = predict.lm(age_model, output),
                   Age = ifelse(is.na(Age),AgePredict,Age))

  # Populate Others: Names represent columns, value is TRUE if column is categorical,
  # false otherwise
  features &lt;- c(&quot;Pclass&quot;=FALSE,
                &quot;Fare&quot;=FALSE,
                &quot;Sex&quot;=TRUE,
                &quot;Title&quot;=TRUE,
                &quot;Age&quot;=FALSE,
                &quot;FamilySize&quot;=FALSE)
  null_handler &lt;- function(is_categorical = TRUE) {
    paste0(&#39;ifelse(is.na(x) | x %in% c(&quot;&quot;,&quot;NA&quot;),&#39;, ifelse(is_categorical,&#39;&quot;Unknown&quot;&#39;,&#39;-1&#39;),&#39;,x)&#39;)
  }
  mutate_fn &lt;- sapply(1:length(features), function(x) {
    paste0(&quot;sapply(&quot;,names(features[x]),&quot;, function(x) { &quot;,null_handler(features[x]),&quot; })&quot;)
  })
  output &lt;- output %&gt;%
            mutate_(
              .dots= setNames(mutate_fn, names(features))
            )
  
  # Specify factors for different features
  output$Sex &lt;- factor(output$Sex, levels = c(&quot;male&quot;,&quot;female&quot;,&quot;Unknown&quot;))
  output$Title &lt;- factor(output$Title, levels = c(&quot;Mr&quot;,&quot;Mrs&quot;,&quot;Miss&quot;,&quot;Master&quot;,&quot;Rare Title / M&quot;,&quot;Rare Title / F&quot;))
  output$Embarked &lt;- factor(output$Embarked, levels = c(&quot;S&quot;,&quot;C&quot;,&quot;Q&quot;,&quot;Unknown&quot;))
  if (is_training) {
    output$Survived &lt;- factor(output$Survived, levels = c(0,1))
  }

  # Specify columns to extract
  if(is_training) {
    columns &lt;- c(&quot;Survived&quot;=TRUE,features)
  } else {
    columns &lt;- features
  }

  output %&gt;% select_(.dots=names(columns))
}

cleaned_set &lt;- clean_data(training_set, age_m)
  
pander(head(cleaned_set))</code></pre>
<div class="table-responsive"><table style="width:90%;">
<colgroup>
<col style="width: 15%" />
<col style="width: 12%" />
<col style="width: 11%" />
<col style="width: 12%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Survived</th>
<th style="text-align: center;">Pclass</th>
<th style="text-align: center;">Fare</th>
<th style="text-align: left;">Sex</th>
<th style="text-align: left;">Title</th>
<th style="text-align: center;">Age</th>
<th style="text-align: center;">FamilySize</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">7.25</td>
<td style="text-align: left;">male</td>
<td style="text-align: left;">Mr</td>
<td style="text-align: center;">22</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">71.28</td>
<td style="text-align: left;">female</td>
<td style="text-align: left;">Mrs</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">7.925</td>
<td style="text-align: left;">female</td>
<td style="text-align: left;">Miss</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">53.1</td>
<td style="text-align: left;">female</td>
<td style="text-align: left;">Mrs</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">8.05</td>
<td style="text-align: left;">male</td>
<td style="text-align: left;">Mr</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">8.458</td>
<td style="text-align: left;">male</td>
<td style="text-align: left;">Mr</td>
<td style="text-align: center;">29.35</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table></div>
</section>
</section>
<section id="the-model" class="level3">
<h3>The Model</h3>
<p>Prior to constructing the random forest model, we will split the training set into two unequal groups, with 80% of the data for training and the other 20% for testing purposes. The larger partition is then used to construct a random forest model.</p>
<p>Listed below is a summary of the model.</p>
<pre class="r"><code>set.seed(1) 
shuffled_set &lt;- training_set[sample(nrow(training_set)),]
training_grp &lt;- shuffled_set[1:floor(0.80 *nrow(shuffled_set)),]
testing_grp &lt;- shuffled_set[floor(0.80 *nrow(shuffled_set) + 1):nrow(shuffled_set),]
  
# Create age estimator using all the dataset
age_m &lt;- age_model(rbind(training_grp, testing_grp))

set.seed(1) 
rf_model &lt;- randomForest(Survived ~ .,
                         data = clean_data(training_grp, age_m),
                         importance=TRUE,
                         ntree=2000)

rf_model</code></pre>
<pre><code>## 
## Call:
##  randomForest(formula = Survived ~ ., data = clean_data(training_grp,      age_m), importance = TRUE, ntree = 2000) 
##                Type of random forest: classification
##                      Number of trees: 2000
## No. of variables tried at each split: 2
## 
##         OOB estimate of  error rate: 16.29%
## Confusion matrix:
##     0   1 class.error
## 0 392  45   0.1029748
## 1  71 204   0.2581818</code></pre>
<section id="assessing-performance" class="level4">
<h4>Assessing Performance</h4>
<p>We use three different indicators to test the accuracy of the model:</p>
<ol type="1">
<li><span class="hl">OOO</span>: The accuracy calculated internally within the model,</li>
<li><span class="hl">20% Testing Group</span>: The accuracy when used to predict the remaining 20% of the data not used in calibration,</li>
<li><span class="hl">Kaggle’s Testing Set</span>: The accuracy when used to predict the test set provided by Kaggle.</li>
</ol>
<pre class="r"><code>ooo_str &lt;- paste0(&quot;Based on OOO: &quot;,round((1 - median(rf_model$err.rate[,1]))*100,1),&quot;% Accuracy Rate&quot;)

# Compare using the testing group
p_y &lt;- predict(rf_model, newdata = clean_data(testing_grp %&gt;% select(-Survived), age_m, is_training=FALSE))
cmp &lt;- cbind(testing_grp %&gt;% select(actual=Survived), predicted=p_y) %&gt;%
             summarise(size=n(),
                       err=sum(ifelse(actual != predicted,1,0)))
int_str &lt;- paste0(&quot;Based on 20% Testing Group: &quot;,round((1 - cmp$err / cmp$size) * 100,1),&quot;% Accuracy Rate&quot;)
    
# Read the test set
test_set &lt;- read.csv(paste0(data_dir, &quot;test.csv&quot;))

# Create age estimator using both the train and test dataset
age_m &lt;- age_model(rbind(training_set %&gt;% select(-Survived),
                         test_set))

# Create model using all the training set
set.seed(1) 
rf_model &lt;- randomForest(Survived ~ .,
                         data = clean_data(training_set, age_m),
                         importance=TRUE,
                         ntree=2000)

# Predict the test set
p_y &lt;- predict(rf_model, newdata = clean_data(test_set, age_m, is_training=FALSE))
predictions &lt;- cbind(test_set %&gt;% select(PassengerId), Survived=p_y)
write.csv(predictions, 
          file=paste0(output_dir,&quot;submission.csv&quot;),
          row.names = FALSE)

# Upload the file to https://www.kaggle.com/c/titanic/submit
ext_str &lt;- paste0(&quot;Based on Kaggle&#39;s Testing Set: 79.4% Accuracy Rate&quot;)

cat(paste0(ooo_str,&quot;\n&quot;,int_str,&quot;\n&quot;,ext_str))</code></pre>
<pre><code>## Based on OOO: 83.7% Accuracy Rate
## Based on 20% Testing Group: 83.2% Accuracy Rate
## Based on Kaggle&#39;s Testing Set: 79.4% Accuracy Rate</code></pre>
<p>As shown above, the model managed to predict Kaggle’s testing set relatively well, with a score below the 18th percentile in the <a href="https://www.kaggle.com/c/titanic/leaderboard" target="_blank">Leaderboard</a> (at time of submission). There is also only a difference of 2-4% between our internal (20% Testing Group) and external (Kaggle’s Testing Set) performance, suggesting that the model is not overfitted.</p>
</section>
<section id="assessing-factors" class="level4">
<h4>Assessing Factors</h4>
<p>Since the model is robust and reliable, we can now derive some knowledge from the model. We will reference the <a data-toggle="popover" title="Mean Decrease In Accuracy" data-content="The degree to which accuracy will fall if the feature/factor of interest is excluded from calibration. (To be more specific, the feature is not excluded, but randomized. Nevertheless, the impact to the model remains the same.) The higher the mean decrease in accuracy, the more important the factor is to the prediction.">mean decrease in accuracy</a> score to determine the importance of each factor.</p>
<p>The chart below maps the mean decrease in accuracy for each feature in the model:</p>
<pre class="r"><code>z_scores &lt;- (rf_model$importance[,&quot;MeanDecreaseAccuracy&quot;] / rf_model$importanceSD[,&quot;MeanDecreaseAccuracy&quot;]) %&gt;%
            { c(.,&quot;Baseline&quot;=2.32) } %&gt;%
            sort() %&gt;%
            { data.frame(&quot;Feature&quot;=names(.),&quot;Zscore&quot;=as.numeric(.)) }
z_scores$Feature &lt;- factor(z_scores$Feature, levels = z_scores$Feature)

z_plot &lt;- ggplot(data = z_scores, aes(x = sapply(z_scores$Zscore, function (x) {max(36,x)}),
                                      y = 0,
                                      color=Feature)) +
          theme_lk() +
          scale_color_manual(name = &quot;Feature&quot;,
                             values = c(txt_color,get_color(&quot;palette&quot;)(7)),
                             guide = guide_legend(nrow=1,
                                                  override.aes=list(size=5))) +
          theme(
            axis.line.x = element_line(colour=NA),
            axis.ticks.x = element_line(colour=NA),
            axis.title.x = element_blank(),
            axis.text.x = element_blank()
          ) +
          # Add X Axis Line
          geom_segment(data = data.frame(1),
               aes(x=35, 
                   xend=38, 
                   y=0, 
                   yend=0),
               size = 0.5,
               color=ltxt_color) +
          geom_segment(data = data.frame(1),
                       aes(x=38, 
                           xend=40, 
                           y=0, 
                           yend=0),
                       size = 0.5,
                       color=ltxt_color,
                       linetype=2) +
          geom_segment(data = data.frame(1),
                       aes(x=40, 
                       xend=73, 
                       y=0, 
                       yend=0),
                       size = 0.5,
                       color=ltxt_color,
                       arrow = arrow(length = unit(10,&quot;pt&quot;),
                                     type = &quot;closed&quot;)) +
          geom_text(data = data.frame(1),
                    label = &quot;Score&quot;,
                    aes(x = 77,
                    y = 0),
                    family = def_font,
                    color = ltxt_color,
                    size = 5,
                    hjust = 1) +
          theme(
            # Y-Axis
            axis.line.y = element_line(colour=NA),
            axis.ticks.y = element_line(colour=NA),
            axis.title.y = element_blank(),
            axis.text.y = element_blank()) +
          scale_y_continuous(limits=c(-0.05, 0.05)) +
          geom_point(size = 15) +
          geom_text(aes(label=paste0(round(Zscore,0))),
                    family = def_font,
                    color = &quot;#FFFFFF&quot;,
                    size = 5,
                    hjust = 0.5)
  
z_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Using a 1% significant level as the baseline, we conclude that all the factors are statistically significant. This means that for each of the factor, there is less than a 1% chance that the influence on survival likelihood is a result of randomness.</p>
<p>Moreover, the model also provides us a picture of which factors are more important than others. For example, characteristics associated with wealth (<span class="hl blue-text">Fare</span> and <span class="hl blue-text">Passenger Class</span>) play more important roles than the passengers’ demographics (<span class="hl purple-text">Title</span>, <span class="hl orange-text">Age</span> and <span class="hl yellow-text">Gender</span>).</p>
</section>
</section>
</section>
<section id="summary-of-results" class="level2">
<h2>Summary of Results</h2>
<p>Using data from the demographics and outcomes of titanic passengers, we have identified a few crucial factors that determines a passenger’s survivalhood.</p>
<p>These factors, ranked by importance, are:</p>
<ol type="1">
<li><span class="hl cyan-text">Passenger Class</span>: 1st and 2nd class passengers accrue additional benefits, such as better amenities and cabin size within the Titanic. Ironically, the benefit most crucial to them was probably the one not advertised: exclusive access to the lifeboats.</li>
<li><span class="hl blue-text">Fares Paid</span>: This is connected to the 1st factor. The higher the fares that passengers pay, the more benefits they accrue, hence the more premium they possess during a sinking disaster.</li>
<li><span class="hl purple-text">Title</span>: Someone with an esteemed title have more privileges than a lay individual on almost every occassion, including this life-or-death situation.</li>
<li><span class="hl red-text">Family Size</span>: Someone with dependents (whether children or a wife) has an advantage of getting into the lifeboats since they can “tag-along” with their dependents.</li>
<li><span class="hl orange-text">Age</span>: The younger the passenger, the less space he/she occupies, hence there are more opportunities for him/her to board the lifeboats.</li>
<li><span class="hl yellow-text">Sex</span>: During that era, females were prioritized over males as a form of gentlemanly behavior. This behavior seems to be translated during the sinking disaster, where females were given preference over men to board the lifeboats first.</li>
</ol>
</section>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
